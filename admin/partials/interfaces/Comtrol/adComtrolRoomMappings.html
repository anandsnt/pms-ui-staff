<section class="content current admin-scrollfix" div-touch-move-stop-propogate ng-click='clearErrorMessage()'>

    <header class="content-title float">
        <h2>Room Mapping</h2>
        <span class="count">({{data.length}})</span>
        <a ng-click="goBackToPreviousState()" class="action back" translate>BACK</a>
        <button ng-click="onClickAdd()" class="action add" scrollup="replacing-div-first">Add new</button>
    </header>

    <div ng-include="'/assets/partials/common/notification_message.html'"></div>

    <section class="content-scroll" style="overflow-x: hidden;">
        <div id="add-new" ng-show="state.mode === 'ADD'">
            <div class="data-holder">
                <form class="form inline-form float">
                    <div class="form-title">
                        <h3><span></span> {{'ADD_ROOM_MAPPING'| translate}} </h3>
                        <em class="status"> {{'MANDATORY_FIELDS_MESSAGE1' | translate}} <strong>*</strong>
                            {{'MANDATORY_FIELDS_MESSAGE2' | translate}} </em>
                    </div>
                    <fieldset class="holder left float">
                        <div class='entry full-width'>
                            <label>{{'ROOM_NO' | translate}}</label>
                            <div class='select'>
                                <select ng-model='state.new.room_no'>
                                    <option value="">{{'SELECT_ROOM_NO_PLACEHOLDER' | translate}}</option>
                                    <option ng-repeat='room in state.roomNumbers' value='{{room.room_number}}'>
                                        {{room.room_number}}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="holder left float">
                        <ad-textbox styleclass="full-width" value="state.new.external_room"
                                    label="{{'EXTERNAL_ROOM' | translate}}"
                                    required="yes"
                                    placeholder="{{'EXTERNAL_ROOM_PLACEHOLDER' | translate}}"></ad-textbox>
                        <ad-dropdown-name label-in-drop-down="{{'SELECT_ACCESS_LEVEL_PLACEHOLDER' | translate}}"
                                          savemodel="state.new.external_access_level"
                                          valueproperty="id"
                                          label-properties="['id', 'value']"
                                          required="yes"
                                          list="state.accessLevels"
                                          label="{{'ACCESS_LEVEL' | translate}}"
                                          class="full-width">
                        </ad-dropdown-name>
                    </fieldset>
                    <fieldset class="holder right float">
                        <ad-textbox styleclass="full-width" value="state.new.external_extension"
                                    label="{{'EXTERNAL_EXTENSION' | translate}}"
                                    required="yes"
                                    placeholder="{{'EXTERNAL_EXTENSION_PLACEHOLDER' | translate}}"></ad-textbox>
                    </fieldset>
                    <div class="actions float">
                        <button type="button" ng-click="onCancelAdd()" class="button blank edit-data-inline"
                                translate>
                            CANCEL
                        </button>
                        <button type="button" ng-click="onSave()" class="button green edit-data-inline"
                                ng-class="{'grey' : state.new.room_no == '' || state.new.external_room === '' || state.new.external_extension === '' || state.new.external_access_level === ''}"
                                ng-disabled="state.new.room_no === '' || state.new.external_room === '' || state.new.external_extension === '' || state.new.external_access_level === ''"
                                translate>
                            SAVE_CHANGES
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <form class="form with-grid float ui-tabs-panel ui-widget-content ui-corner-bottom"
              role="tabpanel"
              aria-expanded="true"
              id="externalMappings"
              aria-hidden="false">
            <!-- Config section and search come here! -->
            <div class="controls-holder filters">
                <div class="table-search three-column">
                    <span class="search-text">Search</span>
                    <span class="icons icon-search" name="submit" type="submit"></span>
                    <input placeholder="" autocomplete="off" type="text" ad-delay-textbox ng-model="searchTerm"
                           delay="1000" function-to-fire="searchEntered"/>
                </div>
            </div>

            <table class="grid"
                   ng-table="tableParams"
                   template-pagination="custom/pager">
                <tbody>
                <tr ng-repeat="mapping in $data track by $index">
                    <td data-item="1" data-title="'Rover Room'" ng-click="onSelect($index, mapping)"
                        header-class="width-30" ng-hide="state.selected === $index">
                        <a class="edit-data-inline">{{mapping.room_no}}</a>
                    </td>
                    <td data-item="2" data-title="'External Room'" ng-click="onSelect($index, mapping)"
                        header-class="width-30" ng-hide="state.selected === $index">
                        <a class="edit-data-inline">{{mapping.external_room}}</a>
                    </td>

                    <td data-item="3" data-title="'External Extension'" ng-click="onSelect($index, mapping)"
                        header-class="width-30" ng-hide="state.selected === $index">
                        <a class="edit-data-inline">{{mapping.external_extension}}</a>
                    </td>

                    <td data-item="4" data-title="'Station Access Level'" ng-click="onSelect($index, mapping)"
                        header-class="width-30" ng-hide="state.selected === $index">
                        <a class="edit-data-inline">{{mapping.external_access_level}} - {{getAccessLevelName(mapping.external_access_level)}}</a>
                    </td>

                    <td header-class="width-10" data-title="'Delete'" class="delete"
                        ng-hide="state.selected === $index">
                        <a class="icons icon-delete large-icon" ng-click="onClickDelete(mapping)"></a>
                    </td>

                    <td colspan="4" ng-show="state.selected === $index">
                        <div style="display: block;" id="add-new" class="edit-data">
                            <div class="data-holder">
                                <!-- Edit Department -->
                                <form class="form inline-form float">
                                    <div class="form-title">
                                        <h3><span></span> {{'EDIT_ROOM_MAPPING'| translate}} </h3>
                                        <em class="status"> {{'MANDATORY_FIELDS_MESSAGE1' | translate}}
                                            <strong>*</strong>
                                            {{'MANDATORY_FIELDS_MESSAGE2' | translate}} </em>
                                    </div>
                                    <fieldset class="holder left float">
                                        <div class='entry full-width'>
                                            <label>{{'ROOM_NO' | translate}}</label>
                                            <div class='select'>
                                                <select ng-model='mapping.room_no'>
                                                    <option value="">{{'SELECT_ROOM_NO_PLACEHOLDER' | translate}}
                                                    </option>
                                                    <option ng-repeat='room in state.roomNumbers'
                                                            value='{{room.room_number}}'>
                                                        {{room.room_number}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <fieldset class="holder left float">
                                        <ad-textbox styleclass="full-width" value="mapping.external_room"
                                                    label="{{'EXTERNAL_ROOM' | translate}}"
                                                    required="yes"
                                                    placeholder="{{'EXTERNAL_ROOM_PLACEHOLDER' | translate}}"></ad-textbox>
                                        <ad-dropdown-name label-in-drop-down="{{'SELECT_ACCESS_LEVEL_PLACEHOLDER' | translate}}"
                                                          savemodel="mapping.external_access_level"
                                                          valueproperty="id"
                                                          label-properties="['id', 'value']"
                                                          required="yes"
                                                          list="state.accessLevels"
                                                          label="{{'ACCESS_LEVEL' | translate}}"
                                                          class="full-width">
                                        </ad-dropdown-name>
                                    </fieldset>
                                    <fieldset class="holder right float">
                                        <ad-textbox styleclass="full-width" value="mapping.external_extension"
                                                    label="{{'EXTERNAL_EXTENSION' | translate}}"
                                                    required="yes"
                                                    placeholder="{{'EXTERNAL_EXTENSION_PLACEHOLDER' | translate}}"></ad-textbox>
                                    </fieldset>
                                    <div class="actions float">
                                        <button type="button" ng-click="onCancelEdit()"
                                                class="button blank edit-data-inline"
                                                translate>
                                            CANCEL
                                        </button>
                                        <button type="button" ng-click="onUpdate(mapping)"
                                                class="button green edit-data-inline"
                                                ng-class="{'grey' : mapping.room_no === '' || mapping.external_room === '' || mapping.external_extension === '' || mapping.external_access_level === ''}"
                                                ng-disabled="mapping.room_no === '' || mapping.external_room === '' || mapping.external_extension === '' || mapping.external_access_level === ''"
                                                translate>
                                            SAVE_CHANGES
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <!--Custom pagination footer goes here-->
            <script type="text/ng-template" id="custom/pager">
                <div class="search-pagination">
                    <div class="entry">
                        Show
                        <div class="select">
                            <select ng-model="displyCount" ng-options="opt for opt in displayCountList"
                                    ng-change="displayCountChanged(displyCount)"></select>
                        </div>
                        mappings per page
                    </div>
                    <button type="button" class="button dark-grey next" ng-repeat="page in pages"
                            ng-show="page.type == 'next'" ng-click="params.page(page.number)"
                            ng-class="{'disabled': !page.active}">Next
                    </button>
                    <button type="button" class="button dark-grey prev" ng-repeat="page in pages"
                            ng-show="page.type == 'prev'" ng-click="params.page(page.number)"
                            ng-class="{'disabled': !page.active}">Prev
                    </button>
                    <p>Showing {{startCount}} to {{endCount}} of {{totalCount}} items</p>
                </div>
            </script>
        </form>
        <!--end-->
    </section>
</section>

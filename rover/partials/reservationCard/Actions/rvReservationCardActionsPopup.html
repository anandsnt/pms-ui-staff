<div id="modal" ng-class="{'modal-show': modalOpened}" role="dialog">
    <form method="post" action="" id="staycard-actions" class="modal-content form staycard-actions">
    <button id="modal-close" type="button" class="dark-title modal-close" ng-click="closeDialog()"><span class="icons icon-close"></button>

    <div class="modal-header">
        <h1>Actions</h1>
        <strong>Room {{$parent.reservationData.reservation_card.room_number}}</strong>

        <div class="dates">
            <div class="date">
                <span class="guest-status small-icon check-in">check-in</span>
                {{actions.arrivalDateString}}
            </div>
            <div class="date">
                <span class="guest-status small-icon check-out">check-out</span>
                {{actions.departureDateString}}
            </div>
        </div>

        <button type="button" class="button green" ng-click='initNewAction()'>New Action</button>
    </div>
    <div ng-show="errorMessage!=''" ng-class="{notice: errorMessage!=''}" class='error error_message' ng-switch on="errorMessage.length" ng-click="clearErrorMessage()">
            <span class="close-btn" ng-click="clearErrorMessage()"></span>
            <span class="actions-small-font">
                            {{errorMessage}}
            </span>
    </div>
    <section class="actions-content" role="main" ng-if='actions.totalCount > 0 || actionSelected === "new"' ng-class="{'action-full-view': actions.totalCount === 0 && actionSelected === 'new'}"> <!-- Add class "no-content" if no actions for room -->

        <!-- Actions list -->
        <div class="content-left" ng-if='actions.totalCount > 0'>
            <div class="scrollable" ng-iscroll="rvActionListScroller" ng-iscroll-delay="500"> <!-- Attach iScroll here -->
                <ul class="wrapper">
                    <li ng-repeat="action in actions" ng-click="selectAction(action)" ng-class="{'active': action.id == selectedAction.id}"> <!-- Add class "overdue" when past due date. Add class "active" when selected, first one should be active by default when screen is loaded -->
                        <span class="icons icon-action icon-{{action.action_status}}" ng-class="{'active': action.id == selectedAction.id, 'action-set-mid': action.over_due == false && action.action_task_type == null}"> <!-- makes each icon a white version for visibility when section is 'active'-->
                            <!-- If overdue, output "Overdue " -->
                            <!--{Alert|Trace|Request} -->
                            <span ng-if="action.over_due" class="actions-overdue-font" ng-class="{'active': action.id == selectedAction.id}" translate>OVERDUE</span><br />
                            <span class="actions-overdue-font" ng-class="{'active': action.id == selectedAction.id}">{{action.action_task_type}}</span>
                            
                        </span>
                        <div class="data">
                            <h3>{{action.description}}</h3>
                            <em>{{action.due_at_date}} &#8226; {{action.due_at_time}}</em>
                        </div>
                        <span class="department">{{action.assigned_to.name}}</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Action summary -->
        <div class="content-right" ng-show="actionSelected === 'selected'"> 
            <div class="summary">
                <div id="action-summary">
                    <h3>{{selectedAction.description}}</h3>
                    <div class="info assigned">
                        <span class="label">Assigned To</span>
                        {{selectedAction.assigned_to.name}}
                    </div>
                    <div class="info created">
                        <span class="label" ng-if="!selectedAction.created_by_null">Created By</span>
                        <span class="label" ng-if="selectedAction.created_by_null">Created </span>
                        {{selectedAction.created_by.name}} {{selectedAction.created_at_date}} &#8226; {{selectedAction.created_at_time}} 
                    </div>
                    <div class="entry action-info date" ng-click="showSelectCalendar()" ng-class="{'overlay': selectedAction.date_completed}">
                        <label for="due-date">Date Due</label>
                        <button class="clear-query"> <!-- Add class "visible" to show (when date is not blank) -->
                            <span class="icons icon-clear-search">Clear query</span>
                        </button>
                        <input id="due-date" type="text" class="datepicker" value="{{selectedAction.due_at_date}}" readonly />
                    </div>
                    <div ng-show="selectCalendarShow" class="ngmodal-uidate-wrap" id="selectCalendar" ng-include="'/assets/partials/reservationCard/Actions/rvReservationCardActionsCalendar.html'">
                    </div>
                    <div class="entry action-info time" ng-class="{'overlay': !selectedAction.hasDate || selectedAction.date_completed}">
                        <label for="due-time">Time Due</label>
                        <div class="select">
                            <select id="due-time" ng-model="selectedAction.time_due" ng-options="time.value for time in timeFieldValue" ng-change="onTimeChange()">
                                <option value="00:00"></option>
                            </select>
                        </div>
                    </div>
                </div>

                
                <div class="notice" ng-show="{{selectedAction.isCompleted}}">
                    <span>Completed By</span>
                    {{selectedAction.completed_by.name}} {{selectedAction.date_completed}} &#8226; {{selectedAction.time_completed}}
                </div> 
                
                <div class="detail-actions col-2" ng-hide="{{selectedAction.isCompleted}}">
                    <button type="button" class="button white brand-text" ng-show="!selectedAction.assigned" ng-hide="selectedAction.assigned" ng-click="assignAction()">Assign</button> <!-- Change text to "Reassign" for assigned action -->
                    <button type="button" class="button white brand-text" ng-show="selectedAction.assigned" ng-hide="!selectedAction.assigned" ng-click="reassignAction()">Re-Assign</button> <!-- Change text to "Reassign" for assigned action -->
                    <button type="button" class="button white green-text" ng-click="completeAction()">Complete</button>
                </div>

                <!-- NEW ACTION
                When "New action" is pressed, replace L37-L70 with L74-L108:
                -->
                

                    
            </div>
        </div>
        
        <div class="content-right" ng-show="actionSelected === 'assign'"> 
            <div class="summary">
             <span class="h2 message">Assign</span>
             <div class="entry full-width">
                 <label for="department">Department</label>
                 <div class="select">
                     <div class="select">
                     <select id="department-assign-action" ng-class="{'placeholder': departmentsCount > 0}" ng-model="departmentSelect.selected" ng-options="department.name for department in departments"> 
                         <option value="">Select department</option>
                     </select>
                 </div>

                 </div>
             </div>
             <div class="assign-reassign">
                 <button type="button" class="button brand-colors" ng-class="{'overlay': !departmentSelect.selected.value}" ng-click="assignDepartment()">Assign</button> 
                 <button type="button" class="button blank" ng-click="cancelAssign()">Cancel</button> 
             </div> 
            </div>      
        </div>
        
        
        <div class="content-right" ng-show="actionSelected === 'new'" ng-class="{'action-full-view': actions.totalCount === 0}"> 
            <div class="summary">
                    <span class="h2 message">New Action</span>
                    <div class="entry full-width">
                        <label for="department">Assign to Department</label>
                        <div class="select">
                            <select id="department-new-action" class="placeholder" ng-model="newAction.department" ng-options="department.name for department in departments"> 
                                <option value="" selected>Select department</option>
                            </select>
                        </div>
                    </div>
                    <div class="entry date margin" ng-click='showNewCalendar()'>
                        <label for="due-date">Date Due</label>
                        <input id="due-date" type="text" class="datepicker" value="{{newAction.date_due}}" readonly />
                    </div>
                    <div ng-show="newCalendarShow" class="ngmodal-uidate-wrap" id="newCalendar" ng-include="'/assets/partials/reservationCard/Actions/rvReservationCardActionsCalendar.html'">
                    </div>
                    <div class='entry actions-mid'></div>
                      
                    <div class="entry actions-end"  ng-class="{'overlay': !newAction.hasDate}">
                        <label for="due-time">Time Due</label>
                        <div class="select">
                            <select id="due-time" ng-model="newAction.time_due" ng-options="time.value for time in timeFieldValue">
                                <option value="00:00"></option>
                            </select>
                        </div>
                    </div>
                    <div class="entry full-width">
                        <label for="notes">Notes</label>
                        <textarea id="notes" ng-model='newAction.notes' name="notes" placeholder="Enter message..." rows="4"></textarea>
                    </div> 
                    <div>
                        <button type="button" class="button green" ng-click='postAction()'>Post Action</button> 
                        <button type="button" class="button blank" ng-click='cancelNewAction()'>Cancel</button> 
                    </div> 
                </div> 
            </div>
        
    </section>
    
    <section class="actions-content no-content" role="main" ng-if='actions.length === 0' >
        <!-- if no actions for room -->
         <div class="info">
            <span class="icon-no-content icon-actions"></span>
            <strong class="h1">No Actions</strong>
            <span class="h2">All is good in Room {{$parent.reservationData.reservation_card.room_number}}</span> 
        </div>
    </section>

</form>
    
    
</div>

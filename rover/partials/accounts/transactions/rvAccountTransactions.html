<form ng-controller="rvAccountTransactionsCtrl" id="group-transactions" name="group-transactions" class="form card-tab inner-header bills" ng-click="errorMessage = '';">
    <div id="account-transactions-header" class="tab-header no-print">
    <ul class="totals">
        <li>
            <div class="data">
                <span class="label" translate>TOTAL_FEES</span>
                <span class="value">{{currencySymbol}}{{transactionsDetails.total_fees | number: precisonTwo}}</span>
            </div>
        </li>
        <li>
            <div class="data">
                <span class="label" translate>TOTAL_BALANCE</span>
                <span class="value" ng-class="{'green': transactionsDetails.total_balance == 0, 'red': transactionsDetails.total_balance != 0}">{{currencySymbol}}{{transactionsDetails.total_balance | number: precisonTwo}}</span> <!-- Green if 0, otherwise red -->
            </div>
        </li>
        <li>
            <!-- <button type="button" class="button blue">
                Billing Information
            </button> -->
        </li>
    </ul>
</div>

<div id="account-transactions-content" class="tab-details">
    <!-- If no transactions: -->
    <div class="no-content" ng-show="transactionsDetails.bills.length === 0">
        <div class="info">
            <span class="icon-no-content icon-groups"></span>
            <strong class="h1" translate>NO_TRANSACTIONS_MESSAGE</strong>
        </div>
    </div>

    <div class="registration-content scrollable" ng-iscroll="registration-content">
        <div class="wrapper">
            <div ng-include="'/assets/partials/common/notification_message.html'"></div>
            <div class="registration-summary" id ="registration-summary">

                <!-- Bills Nav-->
                <div class="bill-tabs scrollable" ng-iscroll="bill-tab-scroller">
                    <ul class="wrapper" style="width:{{getWidthForBillTabsScroll();}}px;">
                        <li ng-class="showActiveBill($index)" click-touch="setActiveBill($index)" ng-repeat="billTab in transactionsDetails.bills">
                            <a class="bill-toggle">
                                <div class="price"><span>{{'BILL' |translate}} #{{billTab.bill_number}}</span>
                                    {{currencySymbol}}{{billTab.total_fees.balance_amount | number: precisonZero}}
                                </div>
                            </a>
                        </li>
                        <!-- Add new bill-->
                        <li class="new-bill" ng-show="transactionsDetails.bills.length<10 && isStandAlone">
                            <button type="button" class="button with-icon only-icon brand-colors" click-touch="createNewBill()">
                                <span class="icons icon-plus"></span>
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Bill -->
                <div class="bill-summary" ng-repeat="billData in transactionsDetails.bills" ng-class="{'hidden': $index!=currentActiveBill}">

                    <!-- Bill Summary -->
                    <div class="bill-summary-wrapper">
                        <div class="scrollable" ng-iscroll="billDays">
                            <ul class="wrapper" style="width{Outer lenght of all li items}px">
                                <li class="add-new">
                                    <button type="button" click-touch="openPostCharge(billData.bill_number)" class="button with-icon brand-colors">
                                        <span class="icons icon-charge"></span>
                                        {{'ADD_CHARGE' |translate}}
                                    </button>
                                </li>
                                <!-- TODO: active class logic -->
                                <li class="active" ng-repeat="days in billData.days" click-touch="showDayRates($index)">
                                    <button class="toggle" type ="button" ng-class="{'active' : dayRates == $index}">
                                        <span class="day">{{days.date | date:'MMM'}} {{days.date | date:'dd'}}</span>
                                        <span class="price">{{currencySymbol}}{{days.total_amount | number: precisonZero}}</span>
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="summary-expanded" ng-repeat="billItem in billData.days" ng-class="{'hidden': $index != dayRates}"> <!-- Remove class "hidden" when item in summary selected -->
                            <table class="expense-details">
                                <thead>
                                    <tr>
                                        <th class="price" translate>EXPENSE</th>
                                        <th translate>DETAILS</th>
                                        <th class="price" translate>CHARGE_TYPE</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="expense in billItem.expense_details">
                                        <td class="price">{{currencySymbol}}{{expense.amount | number: precisonTwo}}</td>
                                        <td ng-bind-html="expense.details"></td>
                                        <td>{{expense.charge_type}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>


                    <!-- Invoice -->
                    <div class="invoice">
                        <ng-include src="'/assets/partials/accounts/transactions/rvAccountInvoice.html'"></ng-include>
                    </div>

                    <!-- Balance / Signature / Card -->
                    <div class="total-stay-fees">

                        <!-- Fees & Balance Overview -->
                        <ul class="group-overview">
                            <li>
                                <span class="title" translate>FEES</span>
                                <span class="value">{{currencySymbol}}{{billData.total_fees.total_amount | number: precisonTwo}}</span>
                            </li>
                            <li class="break">
                                <button type="button" class="button with-icon only-icon blue" click-touch="showFormatBillPopup(billData.bill_number)">
                                    <span class="icons icon-invoice"></span>
                                    {{'INVOICE' |translate}}
                                </button>

                            </li>
                            <li>
                                <span class="title" translate>BALANCE</span>
                                <span class="value" ng-class="{'green': billData.total_fees.balance_amount == 0, 'red': billData.total_fees.balance_amount != 0}">{{currencySymbol}}{{billData.total_fees.balance_amount | number: precisonTwo}}</span> <!-- Green when 0, otherwise red -->
                            </li>
                            <li>
                                <button class="button green with-icon only-icon" click-touch="showPayemntModal()" >
                                    <span class="icons icon-wallet"></span>
                                    {{'PAY' |translate}}
                                </button>
                            </li>
                            <li ng-show="billData.is_routed === 'true'">
                                <span class="title" ng-show="billData.payment_details.payment_type != 'CC'">{{billData.guest_or_company_name}}&nbsp;{{billData.payment_details.payment_type_description}}</span>
                                <!-- Credit Card -->
                                <span class="title" ng-show="billData.payment_details.payment_type === 'CC' && billData.payment_details.payment_type.length >0">{{billData.guest_or_company_name}}&nbsp;{{billData.payment_details.card_number}}</span>
                            </li>

                            <li>
                                <!-- Only when fees selected in table below:-->
                                <button type="button" class="button with-icon only-icon brand-colors"ng-show="((isAllChargeCodesSelected() || isAnyOneChargeCodeIsExcluded())&& hasMoveToOtherBillPermission())&& isStandAlone" ng-click="moveChargesClicked()">
                                    <span class="icons icon-move"></span>
                                    Move selected
                                </button>
                            </li>
                        </ul>

                        <!-- Total Stay Fees -->
                        <div class="details">
                            <table class="total-fees">
                                <thead>
                                    <tr>
                                        <th translate>DATE</th>
                                        <th translate>CHARGE_CODE</th>
                                        <th translate>DESCRIPTION</th>
                                        <th translate>FEES</th>
                                        <th translate>CREDITS</th>
                                        <th class="form" ng-show="showMoveCharges">{{'BILL' |translate}} #</th>
                                        <th class="action" translate>EDIT</th>
                                        <th class="action">
                                            <label class="checkbox inline">
                                                <span class="icon-form icon-checkbox" ng-class="{'checked':isAllChargeCodesSelected(),'semi-checked':isAnyOneChargeCodeIsExcluded()}"></span>
                                                <input id="bill-1-all" ng-model="transactionsDetails.isAllChargeCodeSelected" type="checkbox" ng-change="selectAllChargeCodeToggle()">
                                            </label>
                                        </th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr class="active edit">
                                        <td colspan="3" class="total-label">       <button type="button" class="button with-icon only-icon blue inline" click-touch="showFormatBillPopup(billData.bill_number)">
                                            <span class="icons icon-invoice"></span>
                                            {{'INVOICE' |translate}}
                                            </button>
                                            {{'STAY_FEES' |translate}} ({{'AS_OF' |translate}}  {{billData.total_fees.fees_date | date:dateFormat}}):
                                        </td>
                                        <td colspan="3" class="total-value">
                                             <strong>{{currencySymbol}}{{billData.total_fees.total_amount | number: precisonTwo}}</strong>
                                        </td>
                                        <td>
                                            <!-- <button click-touch="openActionsPopup()" class="button purple with-icon only-icon">
                                                <span class="icons icon-pencil"></span>
                                                Edit
                                            </button> -->
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr class="active edit">
                                        <td colspan="3" class="total-label">
                                            {{'BALANCE' |translate}} ({{'AS_OF' |translate}} {{billData.total_fees.fees_date | date:dateFormat}}):
                                        </td>
                                        <td colspan="3" class="total-value" ng-class="{'green': billData.total_fees.balance_amount == 0, 'red': billData.total_fees.balance_amount != 0}"> <!-- Green when 0, otherwise red -->
                                             <strong>{{currencySymbol}}{{billData.total_fees.balance_amount | number: precisonTwo}}</strong>
                                        </td>
                                        <td>
                                            <button class="button green with-icon only-icon" click-touch="showPayemntModal()">
                                                    <span class="icons icon-wallet"></span>
                                                    {{'PAY' |translate}}
                                            </button>
                                        </td>
                                        <td ></td>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    <tr class="active edit" ng-repeat="feesData in billData.total_fees.fees_details" >
                                        <td>{{feesData.date |date:dateFormat}}</td>
                                        <td>
                                            <span ng-repeat="description in feesData.description">
                                                {{description.charge_code}}
                                                <br />
                                            </span>
                                        </td>
                                        <td class="description">
                                            <span ng-repeat="description in feesData.description">
                                                {{description.fees_desc}}
                                                <br />
                                            </span>
                                            <span ng-show="feesData.reference_text != ''" class="reference">
                                                {{feesData.reference_text}}
                                            </span>
                                        </td>
                                        <td>
                                            <strong>
                                                <span ng-repeat="description in feesData.description" ng-show= "description.fees_amount!=NIL">{{currencySymbol}}{{description.fees_amount | number: precisonTwo}}
                                                </span>
                                            </strong>
                                        </td>
                                        <td>
                                            <strong ng-show="feesData.credits!=''">
                                                {{currencySymbol}}{{feesData.credits| number: precisonTwo}}
                                            </strong>
                                        </td>
                                        <td ng-show="showMoveCharges">
                                            <div class="select">
                                                <select ng-change="moveToBillAction(feesData.oldBillValue, $index)" ng-model="feesData.billValue" iscroll-stop-propagation>
                                                    <option value="" disabled>Move to bill</option>
                                                    <option value="{{billNumbers.bill_number}}" ng-selected="billNumbers.bill_number==(currentActiveBill+1)" ng-repeat="billNumbers in transactionsDetails.bills"> {{billNumbers.bill_number}} </option>
                                                    <option value="{{transactionsDetails.bills.length+1}}" ng-show="transactionsDetails.bills.length<10">{{transactionsDetails.bills.length+1}} &nbsp;&nbsp;({{'NEW_BILL'|translate}})</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <button type="button" class="button purple with-icon only-icon" click-touch="openActionsPopup(feesData.id,feesData.description[0].fees_desc,feesData.description[0].fees_amount,feesData.type.value,feesData.credits)" ng-show="showEditChargeButton(feesData.type.value)">
                                                <span class="icons icon-pencil"></span>
                                                {{'EDIT' |translate}}
                                            </button>
                                        </td>
                                        <td class="action" ng-if="hasMoveToOtherBillPermission()">
                                            <label class="checkbox inline">
                                                <span class="icon-form icon-checkbox" ng-class="{'checked':feesData.isSelected}"></span>
                                                <input ng-model="feesData.isSelected" type="checkbox"/>
                                            </label>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


</form>
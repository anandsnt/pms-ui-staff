<div ng-include="'/assets/partials/common/header.html'"></div>
<section id="rooms-and-rates" class="content reservations-inner" >

    <ul class="reservation-header" id="rooms-and-rates-header">
        <li ng-repeat = "room in rooms" class="load-room" ng-class="{'active': $index == activeRoom , 'hidden' : rooms.length < 2}"> ROOM {{$index + 1}}</li>
    </ul>
    <div id="rooms-and-rates-content" class="reservations-content-wrapper">
        <div class="reservation-filters">
            <div id="change-room-type" class="select" ng-show="activeCriteria == 'ROOM_TYPE'">
              <select ng-model="preferredType" ng-options="roomType.id as roomType.name for roomType in roomTypes|filter:{level:'!!'}" ng-change="filterRooms()" >
                  <option value="">All Room Types</option>
              </select>
          </div>
          <ul id="filter-rooms-and-rates">
            <li id="show-recommended" ng-class="{active: activeCriteria =='RECOMMENDED'}" ng-click="activeCriteria='RECOMMENDED'">Recommended</li>
            <li id="show-type" ng-class="{active: activeCriteria == 'ROOM_TYPE'}" ng-click="activeCriteria='ROOM_TYPE'">Room Type</li>
            <li id="show-rate" ng-class="{active: activeCriteria == 'RATE'}" ng-click="activeCriteria= 'RATE'">Rate</li>
        </ul>
    </div>

    <div id="room-and-rate-types"  ng-iscroll="room_types"  ng-iscroll-delay="500" class="reservation-content rooms-and-rates-content scrollable" style="height:{{containerHeight}}px">
        <ul ng-if="activeCriteria == 'RECOMMENDED'" class="rooms-and-rates wrapper">

        </ul>

        <ul class="rooms-and-rates wrapper" ng-if="activeCriteria == 'ROOM_TYPE'">
            <li ng-repeat= "room in displayData.roomTypes" ng-hide="$index > 1 && showLessRooms">
                <a class="has-arrow toggle" ng-class="{active: selectedRoomType == room.id}" ng-click="setSelectedType(room)">
                    <div class="data">
                        <h2>{{room.name}}</h2>
                        <span ng-show="displayData.roomTypes.length > 0 && $index > 0">For only {{currencySymbol}}{{roomAvailability[room.id].averagePerNight - roomAvailability[displayData.roomTypes[0].id].averagePerNight}} more per night</span>
                    </div>
                    <div class="book-rate" ng-class="{hidden: selectedRoomType == room.id}">
                        <h4>Best Available Rate</h4>
                        <div class="price">{{currencySymbol}}{{roomAvailability[room.id].averagePerNight  | number: 0}}<span>Avg. Rate per night</span></div>
                        <button class="button green" ng-click="handleBooking(room.id,roomAvailability[room.id].defaultRate,$event)">Book</button>
                    </div>
                </a>
                <!-- Rates list -->
                <ul class="rates" ng-class="{hidden: selectedRoomType != room.id}">

                    <li ng-repeat="rate in roomAvailability[room.id].rates">
                        <a class="has-arrow toggle" ng-class="{active: isActive}" ng-init="isActive=false;" ng-click="isActive = !isActive ; refreshScroll()">
                            <h3>{{displayData.allRates[rate].name}}</h3>
                            <div class="price">
                                {{currencySymbol}}{{roomAvailability[room.id].total[rate].average | number: 0}}
                                <span>Avg. Rate per night</span>
                            </div>
                            <button class="button green" ng-click="handleBooking(room.id,rate, $event)">Book</button>
                        </a>
                        <!-- Rate Details -->
                        <div class="rate-details" ng-class="{hidden: !isActive}">
                            <ul class="info">
                                <li ng-bind-html="room.description" ></li>
                                <li>{{displayData.allRates[rate].description}}</li>
                                <li>{{displayData.allRates[rate].deposit_policy.description}}</li>
                                <li>{{displayData.allRates[rate].cancellation_policy.description}}</li>
                            </ul>
                            <table class="room-cost">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Rate</th>
                                        <th>Tax({{tax}}%)</th>
                                        <th>Total</th>
                                        <th class="edit"></th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" class="total-label">Total Room Cost</td>
                                        <td class="total-value">{{currencySymbol}}{{roomAvailability[room.id].total[rate].total | number:2}}</td>
                                        <td class="edit" ng-hide="true">
                                            <a href="modals/apply-discount/" class="open-modal button with-icon only-icon purple edit">
                                                <span class="icons icon-pencil"></span>
                                            </a>
                                        </td>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    <!-- <tr ng-repeat = "breakdown in roomAvailability[room.id].ratedetails | filter : {rate_id : rate }">
                                        <td>{{breakdown.day | date:fullDateFormat}}</td>
                                        <td>{{currencySymbol}}{{breakdown.rate | number: 2}}</td>
                                        <td>{{currencySymbol}}{{breakdown.tax}}</td>
                                        <td>{{currencySymbol}}{{breakdown.rate | number: 2 }}</td> 
                                        <td class="edit"></td>
                                    </tr> -->
                                    <tr ng-repeat = "day in displayData.dates">
                                        <td>{{day.obj | date: dayAndDate }}</td>
                                        <td>{{currencySymbol}}{{roomAvailability[room.id].ratedetails[day.str][rate].rate | number: 2}}</td>
                                        <td>{{currencySymbol}}{{roomAvailability[room.id].ratedetails[day.str][rate].tax | number: 2}}</td>
                                        <td>{{currencySymbol}}{{roomAvailability[room.id].ratedetails[day.str][rate].rate | number: 2}}</td> 
                                        <td class="edit"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                </ul>
            </li>  
            <li id="show-all-rooms-and-rates" class="break" ng-show="showLessRooms && displayData.roomTypes.length > 2 && selectedRoomType == -1" ng-click="showLessRooms = false ; refreshScroll()">
                <span>See more room types</span>
            </li>          
        </ul> 
        <ul ng-if="activeCriteria == 'RATE'" class="rooms-and-rates wrapper">        
            <li class="is-rate" ng-repeat="rate in displayData.availableRates">
                <a class="has-arrow toggle" ng-class="{active: isActive}" ng-init="isActive=false; selectedRoom = -1" ng-click="isActive = !isActive ; refreshScroll()">
                    <div class="data">
                        <h2>{{rate.rate.name}}{{selectedRoom}}</h2>
                    </div>
                    <div class="book-rate">
                        <div class="select">
                            <select name="room-1-type" id="room-1-type" class="placeholder" ng-model="selectedRoom">
                                <option value="-1" selected>Select Room Type</option>
                                <option ng-repeat="room in rate.rooms" value="{{room.id}}">{{room.name}}</option>
                            </select>
                        </div>
                        <div class="price">$249<span>Avg. Rate per night</span></div>
                        <button type="button" class="button green">Book</button>
                    </div>
                </a>
                <ul id="golf-package-details" class="rate-details" ng-class="{hidden: !isActive}">
                    <ul class="info">
                        <li>Winter Promotional Rate - Room Only. Taxes included. Different daily rates listed.</li>
                        <li>Cancel by 4PM on 27-DEC-12 to avoid a penalty charge of 05.00.</li>
                        <li>Cancel by 4:00 PM on 12/27/2014 to avoid a penalty charge of 105.00.</li>
                        <li>A deposit is not required to guarantee your reservation.</li>
                    </ul>
                    <table class="room-cost">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Rate</th>
                                <th>Tax(20%)</th>
                                <th>Total</th>
                                <th class="edit"></th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="total-label">Total Room Cost</td>
                                <td class="total-value">$447</td>
                                <td class="edit">
                                    <a href="modals/apply-discount/" class="open-modal button with-icon only-icon purple edit">
                                        <span class="icons icon-pencil"></span>
                                    </a>
                                </td>
                            </tr>
                        </tfoot>
                        <tbody>
                            <tr>
                                <td>Wednesday, 15-01-2014</td>
                                <td>$100.00</td>
                                <td>$49.00</td>
                                <td>$149.00</td> 
                                <td class="edit"></td>
                            </tr>
                            <tr>
                                <td>Thursday, 16-01-2014</td>
                                <td>$100.00</td>
                                <td>$49.00</td>
                                <td>$149.00</td>
                                <td class="edit"></td> 
                            </tr>
                            <tr>
                                <td>Friday, 17-01-2014</td>
                                <td>$100.00</td>
                                <td>$49.00</td>
                                <td>$149.00</td> 
                                <td class="edit"></td>
                            </tr>
                        </tbody>
                    </table>
                </ul>
            </li>
            <li id="show-all-rooms-and-rates" class="break">
                <span>See more rates</span>
            </li>
        </ul>
    </div>
</section>
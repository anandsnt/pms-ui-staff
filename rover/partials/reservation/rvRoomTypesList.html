<div ng-include="'/assets/partials/common/header.html'"></div>
<section id="rooms-and-rates" class="content reservations-inner" >

    <ul class="reservation-header">
        <li ng-repeat = "room in rooms" class="load-room" ng-class="{'active': $index == activeRoom , 'hidden' : rooms.length < 2} translate"> ROOM_LABEL {{$index + 1}}</li>
    </ul>
    <div class="reservations-content-wrapper">
        <div class="reservation-filters">
            <div class="select" ng-show="activeCriteria == 'ROOM_TYPE'">
              <select ng-model="preferredType" ng-options="roomType.id as roomType.name for roomType in roomTypes|filter:{level:'!!'}|orderBy:'level'" ng-change="filterRooms()" >
                  <option value="" translate>RESV_ALL_ROOMS</option>
              </select>
          </div>
          <div class="find-rates" ng-show="activeCriteria == 'RATE'">
            <button type="submit" name="submit" class="icons icon-search" translate>SEARCH</button>
            <span role="status" aria-live="polite" class="ui-helper-hidden-accessible"></span>
            <input ng-blur="hideResults();" ng-focus="isRateFilterActive = true"  name="find-rates" type="text" placeholder="Find Rates" value="" autocomplete="off" class="ui-autocomplete-input" ng-model="rateFilterText" ng-change="filterRates();">           
        </div>
        <ul>
            <li ng-class="{active: activeCriteria =='RECOMMENDED'}" ng-click="activeCriteria='RECOMMENDED'">{{'RESV_RECOMMENDED'|translate}}</li>
            <li ng-class="{active: activeCriteria == 'ROOM_TYPE'}" ng-click="activeCriteria='ROOM_TYPE'">{{'RESV_ROOM'|translate}}</li>
            <li ng-class="{active: activeCriteria == 'RATE'}" ng-click="activeCriteria= 'RATE'">{{'RESV_RATE'|translate}}</li>
        </ul>
    </div>
    <!-- -->
    <!-- -->

    <div class="reservation-content rooms-and-rates-content scrollable"  ng-iscroll="room_types"  ng-iscroll-delay="500"  style="height:{{containerHeight}}px">
        <div>
            <ul ng-if="activeCriteria == 'RECOMMENDED'" class="rooms-and-rates wrapper">

            </ul>

            <ul class="rooms-and-rates wrapper" ng-if="activeCriteria == 'ROOM_TYPE'">
                <li ng-repeat= "room in displayData.roomTypes" ng-hide="$index > 1 && showLessRooms">
                    <a class="has-arrow toggle" ng-class="{active: selectedRoomType == room.id}" ng-click="setSelectedType(room)">
                        <div class="data">
                            <h2>{{room.name}}</h2>
                            <span ng-show="displayData.roomTypes.length > 0 && $index > 0">{{ 'RESV_FOR_ONLY' | translate}}&nbsp;{{currencySymbol}}{{roomAvailability[room.id].averagePerNight - roomAvailability[displayData.roomTypes[0].id].averagePerNight | number: 0}}&nbsp;{{'RESV_MORE'|translate}}</span>
                        </div>
                        <div class="book-rate" ng-class="{hidden: selectedRoomType == room.id}">
                            <h4 translate>RESV_BEST_RATE</h4>
                            <div class="price">{{currencySymbol}}{{roomAvailability[room.id].averagePerNight  | number: 0}}<span translate>RESV_AVG_NIGHT</span></div>
                            <button class="button green" ng-click="handleBooking(room.id,roomAvailability[room.id].defaultRate,$event)" translate>RESV_BOOK</button>
                        </div>
                    </a>
                    <!-- Rates list -->
                    <ul class="rates" ng-class="{hidden: selectedRoomType != room.id}">

                        <li ng-repeat="rate in roomAvailability[room.id].rates">
                            <a class="has-arrow toggle" ng-class="{active: isActive}" ng-init="isActive=false;" ng-click="isActive = !isActive ; refreshScroll()">
                                <h3>{{displayData.allRates[rate].name}}</h3>
                                <div class="price">
                                    {{currencySymbol}}{{roomAvailability[room.id].total[rate].average | number: 0}}
                                    <span translate>RESV_AVG_NIGHT</span>
                                </div>
                                <button class="button green" ng-click="handleBooking(room.id,rate, $event)" translate>RESV_BOOK</button>
                            </a>
                            <!-- Rate Details -->
                            <div class="rate-details" ng-class="{hidden: !isActive}">
                                <ul class="info">
                                    <li ng-bind-html="room.description" ></li>
                                    <li>{{displayData.allRates[rate].description}}</li>
                                    <li>{{displayData.allRates[rate].deposit_policy.description}}</li>
                                    <li>{{displayData.allRates[rate].cancellation_policy.description}}</li>
                                </ul>
                                <table class="room-cost">
                                    <thead>
                                        <tr>
                                            <th translate>DATE</th>
                                            <th translate>RESV_RATE</th>
                                            <th>{{'TAX'|translate}}({{tax}}%)</th>
                                            <th translate>RESV_TOTAL</th>
                                            <th class="edit"></th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <td colspan="3" class="total-label" translate>RESV_TOTAL_ROOM</td>
                                            <td class="total-value">{{currencySymbol}}{{roomAvailability[room.id].total[rate].total | number:2}}</td>
                                            <td class="edit" ng-hide="true">
                                                <a href="modals/apply-discount/" class="open-modal button with-icon only-icon purple edit">
                                                    <span class="icons icon-pencil"></span>
                                                </a>
                                            </td>
                                        </tr>
                                    </tfoot>
                                    <tbody>           
                                        <tr ng-repeat = "day in displayData.dates">
                                            <td>{{day.obj | date: dayAndDate }}</td>
                                            <td>{{currencySymbol}}{{roomAvailability[room.id].ratedetails[day.str][rate].rate | number: 2}}</td>
                                            <td>{{currencySymbol}}{{roomAvailability[room.id].ratedetails[day.str][rate].tax | number: 2}}</td>
                                            <td>{{currencySymbol}}{{roomAvailability[room.id].ratedetails[day.str][rate].rate | number: 2}}</td> 
                                            <td class="edit"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </li>
                    </ul>
                </li>  
                <li class="break" ng-show="showLessRooms && displayData.roomTypes.length > 2 && selectedRoomType == -1" ng-click="showLessRooms = false ; refreshScroll()">
                    <span translate>RESV_SEE_MORE_ROOMS</span>
                </li>          
            </ul> 
            <ul class="rooms-and-rates wrapper" ng-if="activeCriteria == 'RATE'">      
                <li class="is-rate" ng-repeat="rate in rateFiltered ? filteredRates : displayData.availableRates" ng-init="isActive=false; selectedRoom = rate.rooms[0].id" ng-hide="$index > 1 && showLessRates">
                    <a class="has-arrow toggle" ng-class="{active: isActive}" ng-click="isActive = !isActive ; refreshScroll();">
                        <div class="data">
                            <h2>{{rate.rate.name}}</h2>
                        </div>
                        <div class="book-rate">
                            <div class="select" ng-click="$event.stopPropagation()">
                                <select name="room-1-type" class="placeholder" ng-model="selectedRoom">
                                    <!-- <option value="-1">Select Room Type</option> -->
                                    <option ng-repeat="room in rate.rooms" value="{{room.id}}" ng-selected="$index==0">{{room.name}}</option>
                                </select>
                            </div>
                            <div class="price">{{currencySymbol}}{{roomAvailability[selectedRoom].total[rate.rate.id].average | number:0}}<span translate>RESV_AVG_NIGHT</span></div>
                            <button type="button" class="button green"ng-click="handleBooking(selectedRoom,rate.rate.id, $event)" translate>RESV_BOOK</button>
                        </div>
                    </a>
                    <ul class="rate-details" ng-class="{hidden: !isActive}">
                        <ul class="info">
                            <li ng-bind-html="displayData.roomTypes[selectedRoom].description" ></li>
                            <li>{{displayData.allRates[rate.rate.id].description}}</li>
                            <li>{{displayData.allRates[rate.rate.id].deposit_policy.description}}</li>
                            <li>{{displayData.allRates[rate.rate.id].cancellation_policy.description}}</li>
                        </ul>
                        <table class="room-cost">
                            <thead>
                                <tr>
                                    <th translate>DATE</th>
                                    <th translate>RESV_RATE</th>
                                    <th>{{'TAX'|translate}}({{tax}}%)</th>
                                    <th translate>RESV_TOTAL</th>
                                    <th class="edit"></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="3" class="total-label" translate>RESV_TOTAL_ROOM</td>
                                    <td class="total-value">{{currencySymbol}}{{roomAvailability[selectedRoom].total[rate.rate.id].total | number:2}}</td>
                                    <td class="edit" ng-hide="true">
                                        <a href="modals/apply-discount/" class="open-modal button with-icon only-icon purple edit">
                                            <span class="icons icon-pencil"></span>
                                        </a>
                                    </td>
                                </tr>
                            </tfoot>
                            <tbody>
                                <tr ng-repeat = "day in displayData.dates">
                                    <td>{{day.obj | date: dayAndDate }}</td>
                                    <td>{{currencySymbol}}{{roomAvailability[selectedRoom].ratedetails[day.str][rate.rate.id].rate | number: 2}}</td>
                                    <td>{{currencySymbol}}{{roomAvailability[selectedRoom].ratedetails[day.str][rate.rate.id].tax | number: 2}}</td>
                                    <td>{{currencySymbol}}{{roomAvailability[selectedRoom].ratedetails[day.str][rate.rate.id].rate | number: 2}}</td> 
                                    <td class="edit"></td>
                                </tr>
                            </tbody>
                        </table>
                    </ul>
                </li>
                <li class="break" ng-show="showLessRates && rateFiltered == false && displayData.availableRates.length > 2 && selectedRoomType == -1" ng-click="showLessRates = false ; refreshScroll()">
                    <span translate>RESV_SEE_MORE_RATES</span>
                </li> 
            </ul>
        </div>
    </div>
</section>
<ul class="ui-autocomplete ui-front ui-menu ui-widget ui-widget-content ui-corner-all find-rate" tabindex="0" ng-show="filteredRates.length > 0 && isRateFilterActive==true" style="width: 280px; top: 265px; left: 25px;">
    <li ng-repeat="rate in filteredRates" class="ui-menu-item" role="presentation">
        <a class="ui-corner-all" tabindex="-1"  ng-click="selectRate(rate)">
            <span ng-bind-html="highlight(rate.rate.name, rateFilterText)"></span>
        </a>
    </li>
</ul>
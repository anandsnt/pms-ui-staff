<!-- Navbar -->
<div ng-include="'/assets/partials/common/header.html'"></div>
<!-- Actions -->
<section id="actions" class="content actions-content actions-manager" role="main">

    <!-- Actions list -->
    <div class="content-left">

        <!-- Search / filter -->
        <form method="post" action="" id="actions-search"
              ng-class="{'action_filters_visible open':filterOptions.showFilters}" class="search-form actions-form"
              role="search"> <!-- Add class "open" when filters are opened -->
            <button ng-click="toggleExtraFilters()" type="button" class="button with-icon only-icon"
                    ng-class="{'active open':filterOptions.showFilters}">
                <span class="icons icon-filter"></span>
            </button>

            <div class="entry dates">
                <input id="filter-date" class="button white with-icon only-icon datepicker" value="" readonly
                       click-touch="openDateFilter()"/>
            </div>

            <div class="ngmodal-uidate-wrap" id="selectCalendar"
                 ng-include="'/assets/partials/actionsManager/rvActionsMgrFilterCalendar.html'"
                 ng-hide="(!isStandAlone && !isTrace(selectedAction.action_task_type)) || !filterCalendarShow">
            </div>

            <div class="entry search">
                <button type="button" class="clear-query" ng-class="{'visible':!!filterOptions.query}"
                        ng-click="queryActions(true)">
                    <!-- Add class "visible" to show. Clicking it clears search input and resets results -->
                    <span class="icons icon-clear-search">Clear query</span>
                </button>
                <button type="submit" name="submit" class="icons icon-search">Search</button>
                <input id="actions-query" ng-model="filterOptions.query" placeholder="Search Actions" type="search"
                       class="query" autocomplete="off" rv-delay-textbox delay="1000"
                       function-to-fire="queryActions"/>
            </div>

            <!-- Advanced search fields -->
            <ul id="extra_filters" class="filters">
                <li ng-click="setActiveFilter('ALL')" ng-class="{'active':filterOptions.selectedStatus === 'ALL'}">All
                </li>
                <li ng-click="setActiveFilter('UNASSIGNED')"
                    ng-class="{'active':filterOptions.selectedStatus === 'UNASSIGNED'}">Unassigned
                </li>
                <li ng-click="setActiveFilter('ASSIGNED')"
                    ng-class="{'active':filterOptions.selectedStatus === 'ASSIGNED'}">Assigned
                </li>
                <li ng-click="setActiveFilter('COMPLETED')"
                    ng-class="{'active':filterOptions.selectedStatus === 'COMPLETED'}">Completed
                </li>
            </ul>
        </form>

        <!-- Listing, this is the same list of actions view used for both Action Manager and Actions from within a staycard -->
        <!--<div ng-include="'/assets/partials/common/actions_list.html'" class="scrollable"-->
        <!--ng-iscroll="rvActionListScroller" ng-iscroll-delay="500"></div>-->

        <!-- Listing -->
        <div class="scrollable" ng-iscroll="rvActionListScroller" ng-iscroll-delay="500">
            <ul class="wrapper">
                <!-- Add class "overdue" when past due date. Add class "active" when selected, first one should be active by default when screen is loaded -->
                <li ng-class="{'active': action.id === selectedActionId}" ng-repeat="action in actions"
                    ng-click="onSelectAction(action.id)">
                    <!-- {type} can be "unassigned", "assigned", "completed" or "specials". Also add class "active" when selected, first one should be active by default when screen is loaded -->
                    <span class="icons icon-action {{action.iconClass}}"
                          ng-class="{'active' : action.id === selectedActionId}"
                          ng-if="action.is_overdue === 'true'">
                        {{action.action_type}}
                        overdue
                    </span>
                     <span class="icons icon-action {{action.iconClass}}"
                           ng-class="{'active' : action.id === selectedActionId}"
                           ng-if="action.is_overdue !== 'true'">
                         {{action.action_type}}
                    </span>
                    <div class="data">
                        <h3>{{action.description}}</h3>
                        <em><span class="room">{{action.room_no}}</span>{{action.guest_name}}</em>
                    </div>
                    <span class="department">{{action.departmentName}}</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Action details -->
    <div class="content-right" ng-hide="actions.length === 0">
        <div class="sender-details">
            <figure class="guest-image"> <!-- If accompany, add class accompany -->
                <!-- If accompany, show primary guest image here: <img src="{primary guest}" alt="" /> -->
                <img ng-src="{{selectedAction.guest_image}}" alt=""/>
            </figure>
            <div class="data">
                <h1>{{selectedAction.guest_name}}</h1>
                <strong class="h2" ng-if="selectedAction.room_no">Room {{selectedAction.room_no}}</strong>
            </div>
            <div class="dates">
                <div class="date">
                    <span class="guest-status small-icon check-in">check-in</span>
                    {{selectedAction.arrival_date | date:dayInWeek }}&nbsp;{{selectedAction.arrival_date |
                    date:dateFormat}}
                    &nbsp;{{selectedAction.arrival_time}}
                </div>
                <div class="date">
                    <span class="guest-status small-icon check-out">check-out</span>
                    {{selectedAction.departure_date|date:dayInWeek}}&nbsp;{{selectedAction.departure_date | date:
                    dateFormat}}
                    &nbsp;{{selectedAction.departure_time}}
                </div>
            </div>
            <button type="button" class="button brand-colors" ng-click="toStayCard()">Stay Card</button>
        </div>

        <div class="summary">
            <div id="action-summary">
                <h3>{{selectedAction.description}}</h3>
                <div class="info assigned">
                    <span class="label">Assigned To</span>
                    {{selectedAction.assigned_to.name}}
                </div>
                <div class="info created">
                    <span class="label">Created By</span>
                    {{selectedAction.created_by.name}} {Date Created} &#8226; {Time Created}
                </div>
                <div class="entry action-info date">
                    <label for="due-date">Date Due</label>
                    <button class="clear-query"> <!-- Add class "visible" to show (when date is not blank) -->
                        <span class="icons icon-clear-search">Clear query</span>
                    </button>
                    <input id="due-date" type="text" class="datepicker" value="{Due Date}" readonly/>
                </div>
                <div class="entry action-info time">
                    <label for="due-time">Time Due</label>
                    <input id="due-time" type="time" ng-model="selectedAction.dueTime" placeholder="HH:mm:ss" required/>
                </div>
                <!-- If action completed, show this as well:
                <div class="notice">
                    <span>Completed By</span>
                    {Department} {Date Completed} &#8226; {Time Completed}
                </div> -->
            </div>

            <div class="detail-actions col-2">
                <button type="button" class="button white brand-text">Assign</button>
                <!-- Change text to "Reassign" for assigned action -->
                <button type="button" class="button white green-text">Complete</button>
            </div>
        </div>


    </div>

</section>

<!-- Post form -->
<form method="get" action="" id="actions-post" class="post-form">

    <!-- Change department -->
    <div id="change-department" class="select">
        <select name="change-department" ng-options="department.name for department in departments"
                ng-model="filterOptions.department" ng-change="onDepartmentSelectionChange()">
            <option value="" selected>All Departments</option>
            <option value="department.value" ng-selected="newAction.department == department.value"
                    ng-repeat="department in departments">
                {{department.name}}
            </option>
        </select>
    </div>

    <!-- New Action -->
    <button type="button" class="button green" ng-click='initNewAction()'>New Action</button>
</form> 
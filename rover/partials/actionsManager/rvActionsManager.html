<!-- Navbar -->
<div ng-include="'/assets/partials/common/header.html'"></div>
<!-- Actions -->
<section id="actions" class="content actions-content actions-manager" role="main">

    <!-- Actions list -->
    <div class="content-left">

        <!-- Search / filter -->
        <form method="post" action="" id="actions-search"
              ng-class="{'action_filters_visible open':filterOptions.showFilters}" class="search-form actions-form"
              role="search"> <!-- Add class "open" when filters are opened -->
            <button ng-click="toggleExtraFilters()" type="button" class="button with-icon only-icon"
                    ng-class="{'active open':filterOptions.showFilters}">
                <span class="icons icon-filter"></span>
            </button>

            <div class="entry dates">
                <input id="filter-date" class="button white with-icon only-icon datepicker" value="" readonly
                       click-touch="openDateFilter()"/>
            </div>

            <div class="ngmodal-uidate-wrap" id="selectCalendar"
                 ng-include="'/assets/partials/actionsManager/rvActionsMgrFilterCalendar.html'"
                 ng-hide="(!isStandAlone && !isTrace(selectedAction.action_task_type)) || !filterCalendarShow">
            </div>

            <div class="entry search">
                <button type="button" class="clear-query" ng-class="{'visible':!!filterOptions.query}"
                        ng-click="queryActions(true)">
                    <!-- Add class "visible" to show. Clicking it clears search input and resets results -->
                    <span class="icons icon-clear-search">Clear query</span>
                </button>
                <button type="submit" name="submit" class="icons icon-search">Search</button>
                <input id="actions-query" ng-model="filterOptions.query" placeholder="Search Actions" type="search"
                       class="query" autocomplete="off" rv-delay-textbox delay="1000"
                       function-to-fire="queryActions"/>
            </div>

            <!-- Advanced search fields -->
            <ul id="extra_filters" class="filters">
                <li ng-click="setActiveFilter('ALL')" ng-class="{'active':filterOptions.selectedStatus === 'ALL'}">All
                </li>
                <li ng-click="setActiveFilter('UNASSIGNED')"
                    ng-class="{'active':filterOptions.selectedStatus === 'UNASSIGNED'}">Unassigned
                </li>
                <li ng-click="setActiveFilter('ASSIGNED')"
                    ng-class="{'active':filterOptions.selectedStatus === 'ASSIGNED'}">Assigned
                </li>
                <li ng-click="setActiveFilter('COMPLETED')"
                    ng-class="{'active':filterOptions.selectedStatus === 'COMPLETED'}">Completed
                </li>
            </ul>
        </form>

        <!-- Listing, this is the same list of actions view used for both Action Manager and Actions from within a staycard -->
        <!--<div ng-include="'/assets/partials/common/actions_list.html'" class="scrollable"-->
        <!--ng-iscroll="rvActionListScroller" ng-iscroll-delay="500"></div>-->

        <!-- Listing -->
        <div class="scrollable" ng-iscroll="rvActionListScroller" ng-iscroll-delay="500">
            <ul class="wrapper">
                <!-- Add class "overdue" when past due date. Add class "active" when selected, first one should be active by default when screen is loaded -->
                <li ng-class="{'active': action.id === selectedActionId}" ng-repeat="action in actions"
                    ng-click="onSelectAction(action.id)">
                    <!-- {type} can be "unassigned", "assigned", "completed" or "specials". Also add class "active" when selected, first one should be active by default when screen is loaded -->
                    <span class="icons icon-action {{action.iconClass}}" ng-class="{'active' : action.id === selectedActionId}"
                    ng-if="action.is_overdue === 'true'">
                        {{action.action_type}}
                        overdue
                    </span>
                     <span class="icons icon-action {{action.iconClass}}" ng-class="{'active' : action.id === selectedActionId}"
                           ng-if="action.is_overdue !== 'true'">
                         {{action.action_type}}
                    </span>
                    <div class="data">
                        <h3>{{action.description}}</h3>
                        <em><span class="room">{{action.room_no}}</span>{{action.guest_name}}</em>
                    </div>
                    <span class="department">{{action.departmentName}}</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Action details -->
    <div class="content-right" ng-hide="actions.length === 0">
        <div class="sender-details">
            <figure class="guest-image" ng-show="showGuestDetails"> <!-- If accompany, add class accompany -->
                <!-- If accompany, show primar guest image here: <img src="{primary guest}" alt="" /> -->
                <img src="{{selectedAction.guest_image}}" alt=""/>
            </figure>
            <div class="data" ng-show="showGuestDetails">
                <h1>{{selectedAction.firstname}} {{selectedAction.lastname}}</h1>
                <strong class="h2">Room {{selectedAction.room}}</strong>
            </div>
            <div class="dates" ng-show="showGuestDetails">
                <div class="date">
                    <span class="guest-status small-icon check-in">check-in</span>
                    {{selectedAction.arrive_weekday}}{{selectedAction.arrival_date}} {{selectedAction.arrival_time}}
                </div>
                <div class="date">
                    <span class="guest-status small-icon check-out">check-out</span>
                    {{selectedAction.depart_weekday}}{{selectedAction.departure_date}} {{selectedAction.departure_time}}
                </div>
            </div>
            <button type="button" class="button brand-colors">Stay Card</button>
        </div>
        <div class="summary">
            <!-- Action summary -->
            <div ng-show="showActionSummary()" ng-click="stopEditClick()" class="scrollable">
                <div ng-include=" '/assets/partials/common/actions_summary.html'"></div>
            </div>
            <!-- Action Assignment -->
            <div ng-show="showAssignScreen()" class="scrollable">
                <div ng-include=" '/assets/partials/common/actions_assign.html'"></div>
            </div>
        </div>


    </div>

</section>

<!-- Post form -->
<form method="get" action="" id="actions-post" class="post-form">

    <!-- Change department -->
    <div id="change-department" class="select">
        <select name="change-department" ng-options="department.name for department in departments"
                ng-model="filterOptions.selectedDepartment" ng-change="onDepartmentSelectionChange()">
            <option value="" selected>All Departments</option>
        </select>
    </div>

    <!-- New Action -->
    <button type="button" class="button green" ng-click='initNewAction()'>New Action</button>
</form> 
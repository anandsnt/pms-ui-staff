<div class="nested-view view-current">

	<!-- Nav bar -->
	<div class="no-print" ng-include="'/assets/partials/common/header.html'"></div>

	<section role="complementary" id="registration-details" class="content stay-card-inner check-in">

		<!-- Reservation Header -->
		<div class="reservation-header view-bill">
			<div class="actions">
				<!-- Fullscreen button -->
				<button type="button" data-fullscreen="bill" class="button white icons icon-expand" rv-fullscreen fs-sub-header="{{'Res. #'+lastResBillData.confirm_no}}" fs-toggle-class="fullscreen-bill">Fullscreen</button>
				<!-- Room Charge -->
				<button type="button" class="button" ng-show="shouldShowEnableDisableChargeButton()" ng-click="noPostButtonClicked()" ng-class="{'green':reservationBillData.roomChargeEnabled, 'red': !reservationBillData.roomChargeEnabled}">{{getNoPostButtonTiltle()}}</button>

				<!-- Billing Information Toggle -->
				<button type="button" class="toggle has-arrow" ng-show="routingArrayCount>0 && !isStandAlone" ng-class="{'active':showBillingInfo}" ng-click="showBillingInfoHandle()" translate>BILLING_INFO</button>

				<!-- Billing Information Popup -->
				<button type="button" class="button blue" ng-click="openBillingInformation()" ng-show="isStandAlone" translate>{{billingData.billingInfoTitle}}</button>
			</div>

			<!-- Other header details -->
			<div class="data">
				<span class="room" ng-show="reservationBillData.room_number != ''">
					<span class="guest-status room" translate>ROOM</span>
					<strong id="header-room-num" class="room-number" ng-class="getRoomClass(reservationBillData.reservation_status, reservationBillData.room_status, reservationBillData.fo_status, reservationBillData.room_ready_status, reservationBillData.checkin_inspected_only)"> {{reservationBillData.room_number}} </strong>
					<span id="room-type" class="room-type"> {{reservationBillData.room_type_name}} </span>
				</span>
				<span class="nights">
					<span class="guest-status nights"></span> {{reservationBillData.number_of_nights}}
					{{setNightsString()}}
				</span>
				<span class="date"> <span class="guest-status small-icon check-in" translate></span>
				 {{reservationBillData.checkin_date | date:dayInWeek}}
				 {{reservationBillData.checkin_date | date:dateFormat}} </span>
				<span class="date"> <span class="guest-status small-icon check-out" translate></span>
				{{reservationBillData.checkout_date | date:dayInWeek}}
				{{reservationBillData.checkout_date | date:dateFormat}} </span>
			</div>
		</div>
		<!-- Fullscreen Header -->
		<div ng-include="'/assets/partials/common/rvFullscreenHeader.html'" class="fullscreen-header"></div>
		<!-- Registration Content -->
		<div ng-iscroll="registration-content" ng-iscroll-delay="1000" class="registration-content scrollable" ng-class="{ 'print-registration-card': isPrintRegistrationCard }">
			<div class="wrapper">
				<div ng-include="'/assets/partials/common/notification_message.html'"></div>

				<!-- Billing Information -->
				<div id="billing-information" class="billing-information notice" ng-show="showBillingInfo && !isStandAlone">
					<table>
						<thead>
							<tr>
								<th><span translate>TO_BILL</span> #</th>
								<th><span translate>TO_ROOM</span> #</th>
								<th><span translate>GUEST_OR_COMPANY</span></th>
								<th><span translate>DETAILS</span></th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="routingData in reservationBillData.routing_array">
								<td> {{routingData.bill_number}} </td>
								<td>{{routingData.room_no}}</td>
								<td> {{routingData.guest_or_company}} </td>
								<td> {{routingData.details}} </td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="billing-information" class="billing-information notice" ng-show="showIncomingBillingInfo">
					<table>
						<thead>
							<tr>
								<th><span translate>FROM_ROOM</span> #</th>
								<th></th>
								<th><span translate>FROM_GUEST_NAME</span></th>
								<th><span translate>DETAILS</span></th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="incomingRoutingData in reservationBillData.incoming_routing_array">
								<td> {{incomingRoutingData.room_no}} </td>
								<td></td>
								<td> {{incomingRoutingData.guest_name}} </td>
								<td> {{incomingRoutingData.details}} </td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Rate & Bill Summary -->
            	<div id="bills" class="registration-summary">

            		<!-- Bills summary navigation-->
                	<div class="bill-tabs scrollable" ng-iscroll="bill-tab-scroller" ng-iscroll-delay="100">
                		<ul class="wrapper" style="width:{{getWidthForBillTabsScroll()}}px">
                			<li click-touch="setActiveBill($index)" ng-class="showActiveBill($index)" ng-repeat="billTab in reservationBillData.bills">
								<div class="bill-toggle" ng-class="{'error': billTab.has_crossed_credit_limit}">
									<div class="price" ng-show="isBalanceShown(billTab.is_rate_suppressed)">
										<span translate>BILL #{{billTab.bill_number}}</span>
										<span class="currency">{{currencySymbol}}</span>{{billTab.total_amount | number: precisonZero}}
									</div>
									<div class="price" ng-show="!isBalanceShown(billTab.is_rate_suppressed)">
										<span translate>BILL #{{billTab.bill_number}}</span>
										{{'SUPPRESSED_RATES_TEXT' | translate}}
									</div>
									<div class="payment" ng-show="billTab.credit_card_details.payment_type !== 'CC' && billTab.is_active">
										{{billTab.credit_card_details.payment_type_description}}
									</div>
									<figure class="card-logo" ng-show="billTab.credit_card_details.payment_type == 'CC' &&billTab.is_active">
										<img ng-src="/assets/images/{{billTab.credit_card_details.card_code}}.png" alt="" class="credit-card-image">
										<span class="number"> {{billTab.credit_card_details.card_number}}</span>
									</figure>
									<div class="payment" ng-show="!billTab.is_active">Moved to A/R</div>
								</div>
							</li>
							<li class="new-bill" ng-show="reservationBillData.bills.length<10 && isStandAlone">
								<button type="button" class="button with-icon only-icon brand-colors" ng-click="createNewBill()">
									<span class="icons icon-plus"></span>
								</button>
							</li>
                		</ul>
                	</div>

                	<!-- Incoming Billing Information Toggle -->
					<button type="button" class="incoming-billing toggle has-arrow" ng-show="incomingRoutingArrayCount>0" ng-class="{'active':showIncomingBillingInfo}" ng-click="showIncomingBillingInfoHandle()" translate>INCOMING_BILLING_INFO</button>

					<!-- Bill -->
					<div ng-class="{'hidden': $index!=currentActiveBill}" class="bill-summary" ng-repeat="billData in reservationBillData.bills">

						<!-- Bill Summary -->
						<div class="bill-summary-wrapper">
							<div id="bill-days-new" class="scrollable" ng-iscroll="billDays" ng-iscroll-delay="50">
								<ul class="wrapper" style="width: {{billData.billDaysWidth}}px;">
									<li class="add-new">
										<button type="button" class="button with-icon brand-colors" click-touch="clickedAddCharge(billData.bill_number)" ng-disabled="!billData.is_active" ng-class="{ 'overlay' : !billData.is_active }">
											<span class="icons icon-charge"></span>
											Add Charge
										</button>
									</li>

									<!-- For checkin date -->
									<li click-touch="showDayRates($index, days.date, reservationBillData.checkout_date, reservationBillData.number_of_nights)" ng-repeat="days in billData.days" ng-class="getDaysClass($parent.$index, days.date, reservationBillData.checkin_date, reservationBillData.checkout_date, businessDate)">
										<div class="toggle" ng-class="{'active': $index == dayRates}" ng-show="showDays(days.date,reservationBillData.checkout_date, reservationBillData.number_of_nights, 'others')">
											<span class="day"> {{days.date | date:'EEE'}} </span>
											<span class="date"> {{days.date | date:'dd'}} </span>
											<span class="guest-status check-in small-icon" ng-show="days.date == reservationBillData.checkin_date" translate>CHECK_IN</span>
											<span class="price" ng-show="!isBalanceShown(days.is_rate_suppressed)">{{'SUPPRESSED_RATES_TEXT' | translate}}</span>
											<span class="price" ng-show="isBalanceShown(days.is_rate_suppressed)"><span class="currency">{{currencySymbol}}</span>{{days.amount | number: precisonZero}}</span>
										</div>
									</li>

									<!-- packages -->
									<li class="package active" click-touch="showAddons($index)" ng-repeat="addons in billData.addons">
										<div class="toggle" ng-class="{'active': $index == showAddonIndex}">
											<span class="expense"> {{addons.title}}</span>
											<span class="price" ng-show="addons.package_type != 'PACKAGES'">{{addons.package_type}}</span>
											<span class="price" ng-show="addons.package_type == 'PACKAGES'&&caculateExpenseAmountForPackageAddon(addons.expense_details,addons.amount)=='MULTI'&&caculateExpenseAmountForPackageAddon(addons.expense_details,addons.amount)=='INCL'"><span class="currency">{{currencySymbol}}</span>{{caculateExpenseAmountForPackageAddon(addons.expense_details,addons.amount)}}</span>
											<span class="price" ng-hide="addons.package_type == 'PACKAGES'&&caculateExpenseAmountForPackageAddon(addons.expense_details,addons.amount)=='MULTI'&&caculateExpenseAmountForPackageAddon(addons.expense_details,addons.amount)=='INCL'">{{caculateExpenseAmountForPackageAddon(addons.expense_details,addons.amount)}}</span>
											<span class="price" ng-hide="addons.package_type == 'PACKAGES'">{{addons.amount | number: precisonZero}}</span>
										</div>
									</li>

									<!-- For checkout date -->
									<li click-touch="showDayRates($index, days.date, reservationBillData.checkout_date, reservationBillData.number_of_nights)" ng-repeat="days in billData.days" ng-class="getDaysClass($parent.$index, days.date, reservationBillData.checkin_date, reservationBillData.checkout_date, businessDate)">
										<div class="no-expense" ng-show="showDays(days.date,reservationBillData.checkout_date, reservationBillData.number_of_nights, 'checkout')">
											<span class="day"> {{days.date | date:'EEE'}} </span>
											<span class="date"> {{days.date | date:'dd'}} </span>
											<span class="guest-status check-out small-icon" translate>CHECK_OUT</span>
										</div>
									</li>

									<!-- Group items tab -->
									<li class="package active" click-touch="showGroupItems($index)" ng-repeat="groupItems in billData.group_items">
										<div class="toggle" ng-class="{'active': $index == showGroupItemIndex}">
											<span class="expense"> {{groupItems.title}} </span>
											<!-- CICO-31516 - show if SR -->
											<span class="price" ng-if="!isBalanceShown(billData.is_rate_suppressed)">{{'SUPPRESSED_RATES_TEXT' | translate}} </span>
											<span class="price" ng-if="isBalanceShown(billData.is_rate_suppressed)"><span class="currency">{{currencySymbol}}</span>{{groupItems.amount | number: precisonZero}}</span>
										</div>
									</li>
								</ul>
							</div>

							<!-- Bill Summary Details - Stay Dates -->
							<div class="summary-expanded" ng-class="{'hidden': $index != dayRates}" ng-repeat="billItem in billData.days">
								<a class="toggle has-arrow" ng-click="showRoomDetails($index)" ng-class="{'active': $index == showRoomDetailsIndex}">
									<div class="price" ng-show="!isBalanceShown(reservationBillData.is_rate_suppressed_present_in_stay_dates)">
										{{'SUPPRESSED_RATES_TEXT' | translate}}
										<span translate>+ FEES</span>
									</div>
									<div class="price" ng-show="isBalanceShown(reservationBillData.is_rate_suppressed_present_in_stay_dates)">
										<span class="currency">{{currencySymbol}}</span>{{billItem.amount | number: precisonTwo}}
										<span translate>+ <span translate>FEES</span>
									</div>
									<div class="rate">
										<span translate> RATE_PER_NIGHT </span>
										{{billItem.rate_name}}
									</div>
									<div class="room">
										<span translate> GUEST_ROOM_TYPE </span>
										{{billItem.room_type_name}}
									</div>
								</a>
								<div class="stay-details" ng-class="{'hidden': $index != showRoomDetailsIndex}">
									<div class="rate-details">
										{{billItem.rate_description}}
									</div>
									<div class="room-details" ng-bind-html="billItem.room_type_description"></div>
								</div>
							</div>

							<!-- Bill Summary Details - Packages -->
							<div class="summary-expanded" ng-class="{'hidden': showAddonIndex != $index}" ng-repeat="billAddons in billData.addons">
								<table class="expense-details">
									<thead>
										<tr>
											<th class="price" translate>PRICE</th>
											<th translate>PACKAGE</th>
											<th>QUANTITY</th>
											<th>TYPE</th>
											<th>PROJECTED STAY COST</th>
										</tr>
									</thead>
									<tbody>
										<tr ng-repeat="expense in billAddons.expense_details">
											<td class="price" ng-show="expense.is_inclusive" translate> INCL </td>
											<td class="price" ng-show="!expense.is_inclusive"> <span class="currency">{{currencySymbol}}</span>{{expense.price | number: precisonTwo}} </td>
											<td> {{expense.package}} </td>
											<td> {{expense.quantity}} </td>
											<!--CICO-29775-->
											<td > {{expense.amount_type}} {{expense.post_type}}</td>
											<td class="price" ng-show="expense.is_inclusive" translate> INCL </td>
											<td class="price" ng-show="!expense.is_inclusive"> <span class="currency">{{currencySymbol}}</span>{{expense.effective_quantity*expense.price  | number: precisonTwo}} </td>
										</tr>
									</tbody>
								</table>
							</div>

							<!-- Bill Summary Details - Items per day -->
							<div class="summary-expanded" ng-class="{'hidden': showGroupItemIndex != $index}" ng-repeat="billGroupItems in billData.group_items">
								<table class="expense-details">
									<thead>
										<tr>
											<th translate>EXPENSE</th>
											<th translate>LOCATION</th>
											<th translate>DATE</th>
										</tr>
									</thead>
									<tbody>
										<tr ng-repeat="billGroupExpense in billGroupItems.expense_details">
											<!-- CICO-31516 - show if SR -->
											<td class="price"
												ng-if="!isBalanceShown(billData.is_rate_suppressed)">
													{{'SUPPRESSED_RATES_TEXT' | translate}}
											</td>
											<td class="price"
												ng-if="isBalanceShown(billData.is_rate_suppressed)"> <span class="currency">{{currencySymbol}}</span>{{billGroupExpense.expense | number: precisonTwo}}
											</td>
											<td> {{billGroupExpense.title}} </td>
											<td> {{billGroupExpense.date | date:'MM-dd-yyyy'}} </td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						<!-- Invoice -->
						<div id="invoiceDiv" class="invoice" ng-include="'/assets/partials/bill/rvPrintBillCard.html'"></div>

						<!-- Balance / Signature / Card -->
						<div class="total-stay-fees" ng-include="'/assets/partials/bill/rvTotalStayFees.html'" ></div>

						<!-- Signature -->
						<!--<div ng-include="'/assets/partials/bill/rvSignature.html'"></div>-->

						<!-- Registration card -->
						<div id="regDiv" class="registration-card" ng-include="'/assets/partials/bill/rvRegistrationCard.html'"></div>
					</div>


					<!-- If Check In -->
					<div class="signature-header">
						<h2>Please sign below</h2>
						<button id="clear-signature" type="button" class="button blank red-text">Clear signature</button>
					</div>
					<div id="signature-pad">
						<div class="sig sigWrapper">
							<div id="signature"
								 ui-jq="jSignature"
								 ui-options="signaturePluginOptions"
								 ng-mouseover="disableScroll()"
								 ng-mouseleave="enableScroll()"
								 div-touch-move-stop-propogate>
							</div>
						</div>
					</div>



				</div>
			</div>
		</div>


		<div id="bill{No.}-complete" class="complete-registration form" ng-controller="RVReservationCheckInFlowCtrl" ng-show="clickedButton == 'checkinButton'">
			<div class="entry">
				<label class="checkbox inline"
					   ng-show="reservationBillData.is_disabled_terms_conditions_checkin === 'false'">
					<span class="icon-form icon-checkbox" ng-class="{'checked': saveData.termsAndConditions}"></span>
					<input type="checkbox" class="termsandconditions-checkbox" ng-model="saveData.termsAndConditions">
					<div class="agree-terms-and-conditions" click-touch="termsAndConditionsClicked()">{{ 'T_AND_C_TEXT' |
						translate }} checkin
					</div>
				</label>
				<label id="subscribe-via-email" class="checkbox inline checked">
					<span class="icon-form icon-checkbox" ng-class="{'checked': saveData.promotions}"></span>
					<input type="checkbox" value="1" name="checkin" checked="" ng-model="saveData.promotions">
					{{ 'PROMO_NEWS_BY_EMAIL_TEXT' | translate }} </label>
			</div>
			<div class="actions">
				<!-- Complete checkin button disabled out until ready / vacant room is assigned -->

				<!-- Advance put in Queue flow now exists, from admin -> rooms -> housekeeping -> ENABLE ADVANCED QUEUE PRE-CHECKIN -->
				<!--  if using the advanced queue flow, only via 'Put in Queue' will the button text change, all other functionality is the same: CICO-19673-->
				<button ng-show="!putInQueue"
						click-touch="checkIn()"
						data-room-status="READY"
						data-reseravation-status="CHECKING_IN"
						data-required-signature="CHECKIN"
						data-key-settings="encode"
						data-fo-status="VACANT"
						class="button green" translate>
					COMPLETE_CHECKIN
				</button>
				<button ng-show="putInQueue"
						id="checkin-button" click-touch="clickedCompleteAddToQueue()"
						data-room-status="READY"
						data-reseravation-status="CHECKING_IN"
						data-required-signature="CHECKIN"
						data-key-settings="encode"
						data-fo-status="VACANT"
						class="button green" translate>
					COMPLETE_ADD_TO_QUEUE
				</button>


				<div class="clearButton" ng-show="reservationBillData.required_signature_at === 'CHECKIN'">
					<a id="clear-signature" class="button blank" click-touch='clickedClearSignature()'
					   ng-hide="isSigned() || reservation.reservation_card.is_pre_checkin" translate>CLEAR_SIGNATURE</a>
				</div>
			</div>
		</div>


	</section>

</div>

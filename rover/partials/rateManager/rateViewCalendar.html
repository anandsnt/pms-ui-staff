<div class="scrollBound">
<div class='scrollTable pinnedLeft' scroll-position="initScrollBind()" style="overflow:hidden;height:{{uiOptions.tableHeight}}px;">
    <table class='rate-calendar' style="width: 220px;">
        <thead>
            <tr>
                <th class="cell first-row" style="height: 69px; padding: 0 20 0 0">
                    <button ng-click="openCloseAllRestrictions('remove')" 
                            class="button green" 
                            ng-class="{'grey': calendarData.disableOpenAllBtn}" 
                            ng-disabled="calendarData.disableOpenAllBtn">
                        Open All
                    </button>
                    <button ng-click="openCloseAllRestrictions('add')" 
                            class="button red" 
                            ng-class="{'grey': calendarData.disableCloseAllBtn}" 
                            ng-disabled="calendarData.disableCloseAllBtn">
                        Close All
                    </button>
                </th>
            <tr>
        </thead>
        <tbody>
            <tr ng-if="calendarData.data.length > 1">
                <td class="first-row cell">
                    <span class="bolder">All Rates</span><span>&nbsp;</span>
                </td>
            </tr>

            <tr class="cell" style="height:67px" ng-repeat="rate in calendarData.data track by rate.id" ng-class="{'last': $last && loading === false}" ng-show="calendarMode === 'RATE_VIEW'">
                <td class="first-row">
                    <div ng-click="goToRoomTypeCalendarView(rate)">
                        <span bindonce bo-html="rate.name" title="{{rate.name}}"></span>
                        <span> 
                            <img src="/assets/arrow-down.png" />
                        </span>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div ng-if='!uiOptions.isIpad' scroll-position="initScrollBind()" class="scrollTable" id="rateViewCalendar" style="height:{{uiOptions.tableHeight}}px;">
    <table class="rate-calendar" style="width:{{uiOptions.tableWidth}}px;">
        <thead>
            <tr class="cell">
                <th ng-repeat="date in calendarData.dates track by $index" 
                    style="width:{{uiOptions.columnWidth}}px;"> 
                    <div class="date-header">
                        <span class="week-day">{{date| date:'EEEE'}}</span>
                        <span>{{date| date:'MMMM dd'}}</span>
                    </div>
                    <div class="cell-overlay" ng-if="isHistoryDate(date)"></div>
                </th>
            </tr>
        </thead>

        <tbody>
            <tr ng-if="calendarData.data.length > 1">

                <td bindonce ng-repeat="date in calendarData.dates track by $index" class="cell" >
                    <div class="cell-container" >
                        <div class="cell-content" ng-click="showUpdatePriceAndRestrictionsDialog(date, '', '', 'RATE_TYPE', true)">
                            <div>
                                <div>
                                    <div>

                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, calendarData.all_rates[date]) == 3 && calendarData.all_rates[date].length <= 3" 
                                              ng-repeat="restriction in calendarData.all_rates[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon right {{calendarData.restriction_types[restriction.type_id].background_class}} {{calendarData.restriction_types[restriction.type_id].icon}}"> {{restriction.days}} 
                                        </span>	
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, calendarData.all_rates[date]) == 3 && calendarData.all_rates[date].length > 3" 
                                              ng-repeat="restriction in calendarData.all_rates[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon left-icons {{calendarData.restriction_types[restriction.type_id].background_class}} {{calendarData.restriction_types[restriction.type_id].icon}}"> {{restriction.days}} 
                                        </span>	
                                        <span ng-if="calendarData.all_rates[date].length > 3 && currentFilterData.zoom_level_selected < 6" class="restriction-icon left-icons ellipsis">...</span>

                                        <!-- if more than 1 restriction, depending on zoom, show Restrictions icon or first 3 restrictions -->
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, calendarData.all_rates[date]) == 2"
                                              class="restriction-icon right bg-drk"> R 
                                        </span>	

                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="cell-overlay" ng-if="isHistoryDate(date)"></div>
                    </div>
                </td>
            </tr>

            <tr ng-repeat="rate in calendarData.data track by rate.id" ng-class="{'last': $last && loading === false}" ng-show="calendarMode === 'RATE_VIEW'">

                <td bindonce ng-repeat="date in calendarData.dates track by $index" class="cell" >
                    <div class="cell-container" >
                        <div class="cell-content" ng-click="showUpdatePriceAndRestrictionsDialog(date, rate.id, '', 'RATE_TYPE', false)">
                            <div>
                                <div>
                                    <div>
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, rate[date]) == 3 && rate[date].length <= 3"
                                              ng-repeat="restriction in rate[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon right {{calendarData.restriction_types[restriction.restriction_type_id].background_class}} {{calendarData.restriction_types[restriction.restriction_type_id].icon}}"> {{restriction.days}} 
                                        </span>
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, rate[date]) == 3 && rate[date].length > 3"
                                              ng-repeat="restriction in rate[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon left-icons {{calendarData.restriction_types[restriction.restriction_type_id].background_class}} {{calendarData.restriction_types[restriction.restriction_type_id].icon}}"> {{restriction.days}} 
                                        </span>
                                        <span ng-if="rate[date].length > 3 && currentFilterData.zoom_level_selected < 6" class="restriction-icon left-icons ellipsis">...</span>

                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, rate[date]) == 2"
                                              class="restriction-icon right bg-drk"> R 
                                        </span>	


                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="cell-overlay" ng-if="isHistoryDate(date)"></div>
                    </div>
                </td>
            </tr>
            
        </tbody>
    </table>
</div>
    <div ng-if='uiOptions.isIpad' scroll-position="initScrollBind()" class="scrollTable" id="rateViewCalendar" style="height:{{uiOptions.tableHeight}}px;" ng-iscroll="RateCalendarCtrl" ng-iscroll-delay="1000">
    <table class="rate-calendar" style="width:{{uiOptions.tableWidth}}px;">
        <thead>
            <tr class="cell">
                <th ng-repeat="date in calendarData.dates track by $index" 
                    style="width:{{uiOptions.columnWidth}}px;"> 
                    <div class="date-header">
                        <span class="week-day">{{date| date:'EEEE'}}</span>
                        <span>{{date| date:'MMMM dd'}}</span>
                    </div>
                    <div class="cell-overlay" ng-if="isHistoryDate(date)"></div>
                </th>
            </tr>
        </thead>

        <tbody>
            <tr ng-if="calendarData.data.length > 1">

                <td bindonce ng-repeat="date in calendarData.dates track by $index" class="cell" >
                    <div class="cell-container" >
                        <div class="cell-content" ng-click="showUpdatePriceAndRestrictionsDialog(date, '', '', 'RATE_TYPE', true)">
                            <div>
                                <div>
                                    <div>

                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, calendarData.all_rates[date]) == 3 && calendarData.all_rates[date].length <= 3" 
                                              ng-repeat="restriction in calendarData.all_rates[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon right {{calendarData.restriction_types[restriction.type_id].background_class}} {{calendarData.restriction_types[restriction.type_id].icon}}"> {{restriction.days}} 
                                        </span>	
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, calendarData.all_rates[date]) == 3 && calendarData.all_rates[date].length > 3" 
                                              ng-repeat="restriction in calendarData.all_rates[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon left-icons {{calendarData.restriction_types[restriction.type_id].background_class}} {{calendarData.restriction_types[restriction.type_id].icon}}"> {{restriction.days}} 
                                        </span>	
                                        <span ng-if="calendarData.all_rates[date].length > 3 && currentFilterData.zoom_level_selected < 6" class="restriction-icon left-icons ellipsis">...</span>

                                        <!-- if more than 1 restriction, depending on zoom, show Restrictions icon or first 3 restrictions -->
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, calendarData.all_rates[date]) == 2"
                                              class="restriction-icon right bg-drk"> R 
                                        </span>	

                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="cell-overlay" ng-if="isHistoryDate(date)"></div>
                    </div>
                </td>
            </tr>

            <tr ng-repeat="rate in calendarData.data track by rate.id" ng-class="{'last': $last && loading === false}" ng-show="calendarMode === 'RATE_VIEW'">

                <td bindonce ng-repeat="date in calendarData.dates track by $index" class="cell" >
                    <div class="cell-container" >
                        <div class="cell-content" ng-click="showUpdatePriceAndRestrictionsDialog(date, rate.id, '', 'RATE_TYPE', false)">
                            <div>
                                <div>
                                    <div>
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, rate[date]) == 3 && rate[date].length <= 3"
                                              ng-repeat="restriction in rate[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon right {{calendarData.restriction_types[restriction.restriction_type_id].background_class}} {{calendarData.restriction_types[restriction.restriction_type_id].icon}}"> {{restriction.days}} 
                                        </span>
                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, rate[date]) == 3 && rate[date].length > 3"
                                              ng-repeat="restriction in rate[date]| limitTo: 3 track by $index" 
                                              ng-show="toggleRestrictionIconView()"
                                              class="restriction-icon left-icons {{calendarData.restriction_types[restriction.restriction_type_id].background_class}} {{calendarData.restriction_types[restriction.restriction_type_id].icon}}"> {{restriction.days}} 
                                        </span>
                                        <span ng-if="rate[date].length > 3 && currentFilterData.zoom_level_selected < 6" class="restriction-icon left-icons ellipsis">...</span>

                                        <span ng-if="isRestrictTo(currentFilterData.zoom_level_selected, rate[date]) == 2"
                                              class="restriction-icon right bg-drk"> R 
                                        </span>	


                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="cell-overlay" ng-if="isHistoryDate(date)"></div>
                    </div>
                </td>
            </tr>
            
        </tbody>
    </table>
</div>
</div>
<div class='pinned-bottom'>
<ul class="restriction-legends" >
    <li bindonce ng-repeat="restrictionType in calendarData.restriction_types">
        <span class="restriction-icon {{restrictionType.background_class}} {{restrictionType.icon}}" 
              bo-html="restrictionType.days"></span>	
        <span bo-html="restrictionType.description"></span>
    </li>
</ul>
    </div>

<div role="dialog" id="modal" class="modal-show">
	<form method="post" action="post-charge" id="post-charge" name="post-charge" class="modal-content post-charge extended">
	    <button class="modal-close dark-title" id="modal-close" type="button"><span class="icons icon-close"></span></button>
	
	    <!-- Inner confirmation popups. When includimg them, make sure they're part of the 'modal-content' form/div
	    <div id="cant-post" class="inner-overlay">
			<div class="inner-content">
				<span class="message h2">No guest/room selected!</span>
				<span class="text">You need to select guest or room number!</span>
				<button type="button" class="button green">Add guest/room</button>
				<button type="button" class="button blank">Cancel</button>
			</div>
		</div>
	
		<div id="not-checked-in" class="inner-overlay">
			<div class="inner-content">
				<span class="message h2">Guest has not yet checked in!</span>
				<span class="text">Proceed with posting?</span>
				<button type="button" class="button green">Post charge</button>
				<button type="button" class="button blank">Cancel</button>
			</div>
		</div>
	
		<div id="charge-posted" class="inner-overlay">
			<div class="inner-content">
				<span class="message h2">Charge posted</span>
				<button type="button" class="button green">Post another charge</button>
				<button type="button" class="button blank modal-close">Close window</button>
			</div>
		</div> -->
	
		<!-- Card search -->
		<div class="cards guest-card" role="complementary" ng-class="{'cards-list': showSearchScreen }">
		<div class="cards-wrapper">
		    <!-- Cards Header -->
		    <header class="cards-header">
		    	<div class="card-header">
		        	<figure class="guest-image">
			            <img src="/assets/avatar-female.png" alt="" />
			            <span class="search-indicator"></span>
			        </figure>
			        <div class="card-search-form">
			            <div class="holder">
			                <div class="entry">
			                    <input ng-click="showHideInitialSearchScreen()" ng-model="search.room" placeholder="Room Number" value="" type="text" class="masked-input fixed h1" rv-delay-textbox delay="1000" function-to-fire="searchForResults"/>
								<input ng-click="showHideInitialSearchScreen()" ng-model="search.guest_company_agent" placeholder="Guest, Company or Travel Agent" value="" type="text" class="masked-input fixed long-name h1" rv-delay-textbox delay="1000" function-to-fire="searchForResults"/>
			                </div>               
			            </div>
			        </div>
			        <div class="card-actions">
				    	<button type="button" class="button white red-text" ng-click="clickedCancel()">Cancel</button>
				    </div>
			    </div>
		    </header>
	
		    <!-- Cards Content -->
		    <div class="cards-content">
		    	<div class="card-search card-content" ng-class="{'display-card-search': showSearchScreen}">
		    		<!-- Initially, when no results -->
		    		<div id="search-guests-for-charge-no-results" class="search-cards no-content" ng-show="showInitialSearchScreen">
		                <div class="info">
		                    <span class="icon-no-content icon-guest"></span>
		                    <strong class="h1">Find Reservation</strong>
		                    <span class="h2">Search <em>Room</em> by <strong>Number</strong> or <em>Reservation</em> by <strong>Guest</strong>, <strong>Company</strong> or <strong>Travel Agent</strong> Name</span>
		                </div>
		            </div> 
	
		    		<!-- When you have results, use the same markup as on reservation search screen. -->
		        	
		        	<div id="search-guests-for-charge-content" class="search-cards reservation-list scrollable" ng-iscroll='search-guests-for-charge-content' ng-iscroll-delay='300' ng-show="!showInitialSearchScreen" ng-class="{'hidden': itemsVisible}">
		                <div class="wrapper">
		                    <ul id="search-guests-for-charge-results" class="search-results">
		                    	<li class="reservation" ng-click="clickedReservationToPostCharge(reservations.id)" ng-show="reservations.shouldShowReservation" ng-repeat="reservations in reservationsArray">
		                    		<a class="guest-{reservation-status}">
		                    			<figure class="guest-image">
		                    				<img src="{guest-image}" alt="" />
		                    			</figure>
		                    			<div class="data">
		                    				<h2>{{reservations.lastname}}, {{reservations.firstname}}</h2>
		                    				<span class="confirmation">{{reservations.confirmation}}</span>
		                    				<span class="icons icon-location">{{reservations.location}}</span>
		                    			</div>
		                    			<div class="status {queued}">
		                    				<span class="guest-status {reservation-status}">arrival</span>
		                    			</div>
		                    			<strong class="room-number {room status}">
		                    				{{reservations.room}}
		                    			</strong>
		                    		</a>
		                    	</li>
		                    	
		                    </ul>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
	</div>
	
	    <!-- Left side -->
	    <!-- <fieldset class="content-left" ng-class="{'hidden': !itemsVisible}">
	        <div role="search" class="search-form">
				<div class="select">
					<select
						name="charge-groups"
						id="charge-groups"
						ng-model="chargeGroup"
						ng-change = "filterbyChargeGroup()">
						<option value="" class="placeholder" translate>ALL_CHARGE_GROUPS</option>
						<option value="FAV" translate>FAVORITE</option>
						<option ng-repeat="group in fetchedData.charge_groups" value="{{ group.value }}">
					        {{ group.name }}
					    </opzion>
					</select>
				</div>
				<div class="entry">
					<a class="icons icon-clear-search visible" href="" id="clear-query" ng-show="query" ng-click="clearQuery()">Clear query</a>
					<button type="button" name="submit" class="icons icon-search">
						Search
					</button>
					<input type="search" placeholder="{{ 'SEARCH_TERM' |translate }}" name="query" id="query" autocomplete="off" ng-model="query" ng-change="filterByQuery()">
				</div>
			</div>
			<div id="items-listing" class="scrollable">
				<ul id="search-item-results" class="wrapper">
					<li id="items-list" ng-repeat="each in fetchedItems" ng-show="each.show" ng-click="addItem(each)">
						<a class="button white">
							<span ng-bind-html="'{{ each.item_name }}' | highlight:query:false"></span>
							<span class="price">
								{{ currencySymbol }} <span class="value">{{ each.unit_price | number : 2 }}</span>
							</span>
							<span ng-if="each.count > 0" class="count">{{ each.count }}</span>
						</a>
					</li>
					<li id="items-list" ng-repeat="each in fetchedChargeCodes" ng-show="each.show && isResultOnFetchedChargecode" ng-click="addItem(each)">
						<a class="button white">
							<span ng-bind-html="'{{ each.description }}' | highlight:query:false"></span>
							<span class="price">
								<span class="value" ng-bind-html="'{{ each.charge_code }}' | highlight:query:false"></span>
							</span>
							<span ng-if="each.count > 0" class="count">{{ each.count }}</span>
						</a>
					</li>
				</ul>
			</div>
	    </fieldset> -->
	
	    <!-- Right side -->
	    <!-- <fieldset class="content-right" ng-class="{'hidden': !itemsVisible}">
	        <span class="h2 message">
    Post charge to Bill #<!-- when initiated from bill summary screen, just show the number -->
    <!-- <div class="select">
        <select name="post-charge-to-bill">
            <option value="bill1" selected>1</option>
            .. repeat for all bills
            <option value="new-bill">X &nbsp;&nbsp;&nbsp;(Will create new bill)</option>
       
        </select>
    </div>
</span> --> 
<!-- No items added - showed initially 
<div id="no-items-added" class="no-content">
    <div class="info">
        <strong class="h1">0 items selected</strong>
    </div>
</div> -->

<!-- Items added -->
<!-- div id="items-added"> 
    <div id="items-summary" class="scrollable">
        <ul class="wrapper">
            <li> 
            
                {item name}
                <span class="count">({count})</span> 
                <span class="base">at {base price / per unit}</span>
                <span class="price">$ <span class="value">{total charge cost}</span></span>
            
            </li>
            .. repeat for each added
        </ul>
    </div>

    <p id="total-charge"> -->
    	 <!-- add class offset-1 when 1 item added, offset-2 when 2 items added, offset-3 for 3 items, and offset-4 when 4 items added. When 5th element is added, remove class attribute -->
        <!-- Total <span class="price">$ 
            <span class="value">{total charge cost}</span>
        </span>
    </p>

    <div id="numpad">
        <div id="numpad-numbers">
            <button type="button" value="1" class="button white">1</button>
            <button type="button" value="2" class="button white">2</button>
            <button type="button" value="3" class="button white">3</button>
            <button type="button" value="4" class="button white">4</button>
            <button type="button" value="5" class="button white">5</button>
            <button type="button" value="6" class="button white">6</button>
            <button type="button" value="7" class="button white">7</button>
            <button type="button" value="8" class="button white">8</button>
            <button type="button" value="9" class="button white">9</button>
            <button type="button" value="+/-" class="button white small">+/-</button>
            <button type="button" value="0" class="button white">0</button>
            <button type="button" value="." class="button white small">.</button>
        </div>

        <div id="numpad-options">
            <button type="button" value="QTY" class="button white numpad-toggle">QTY</button>
            <button type="button" value="PR" class="button white numpad-toggle selected">PR</button>
            <button type="button" value="undo" class="button white with-icon only-icon clear-value"><span class="icons icon-clear"></span>Clear last value</button>
            <button type="button" value="delete" class="button white with-icon only-icon remove-item"><span class="icons icon-trash"></span>Remove item</button>
        </div>
    </div>

    <div class="actions float">
        <button type="button" class="button green">Post charge</button> <!-- can have class grey instead of green when generic post charge -->
       <!-- <button type="button" class="button blank modal-close">Cancel</button>
    </div>
</div>
	    </fieldset> -->
	    
	    
	    
	    <span ng-controller="RVPostChargeController">
	    <fieldset class="content-left">
			<div role="search" class="search-form">
				<div class="select">
					<select
						name="charge-groups"
						id="charge-groups"
						ng-model="chargeGroup"
						ng-change = "filterbyChargeGroup()">
						<option value="" class="placeholder" translate>ALL_CHARGE_GROUPS</option>
						<option value="FAV" translate>FAVORITE</option>
						<option ng-repeat="group in fetchedData.charge_groups" value="{{ group.value }}">
					        {{ group.name }}
					    </opzion>
					</select>
				</div>
				<div class="entry">
					<a class="icons icon-clear-search visible" href="" id="clear-query" ng-show="query" ng-click="clearQuery()">Clear query</a>
					<button type="button" name="submit" class="icons icon-search">
						Search
					</button>
					<input type="search" placeholder="{{ 'SEARCH_TERM' |translate }}" name="query" id="query" autocomplete="off" ng-model="query" ng-change="filterByQuery()">
				</div>
			</div>
			<div id="items-listing" class="scrollable">
				<ul id="search-item-results" class="wrapper">
					<li id="items-list" ng-repeat="each in fetchedItems" ng-show="each.show" ng-click="addItem(each)">
						<a class="button white">
							<span ng-bind-html="'{{ each.item_name }}' | highlight:query:false"></span>
							<span class="price">
								{{ currencySymbol }} <span class="value">{{ each.unit_price | number : 2 }}</span>
							</span>
							<span ng-if="each.count > 0" class="count">{{ each.count }}</span>
						</a>
					</li>
					<li id="items-list" ng-repeat="each in fetchedChargeCodes" ng-show="each.show && isResultOnFetchedChargecode" ng-click="addItem(each)">
						<a class="button white">
							<span ng-bind-html="'{{ each.description }}' | highlight:query:false"></span>
							<span class="price">
								<span class="value" ng-bind-html="'{{ each.charge_code }}' | highlight:query:false"></span>
							</span>
							<span ng-if="each.count > 0" class="count">{{ each.count }}</span>
						</a>
					</li>
				</ul>
			</div>
		</fieldset>
		<!-- Right side -->
		<fieldset class="content-right">
			<div ng-include="'/assets/partials/common/notification_message.html'"></div>

			<span class="h2 message">
				<span translate>POST_CHARGE_TO_BILL</span> #<span ng-show="passActiveBillNo">{{ passActiveBillNo }}</span>
				<div id="select-bill-number" class="select" ng-hide="passActiveBillNo">
					<select ng-model="billNumber">
					    <option ng-repeat="no in fetchedData.bill_numbers" ng-selected="{{no == billNumber}}" value="{{ no }}">
					        {{ no }}
					    </opzion>
					</select>
				</div> </span>
			<div id="no-items-added" class="no-content" ng-hide="isAnyChosen()">
				<div class="info">
					<strong class="h1" translate>0_ITEM_SELECTED</strong>
				</div>
			</div>
			<div id="items-added" ng-show="isAnyChosen()">
				<div id="items-summary" class="scrollable">
					
					<ul class="wrapper">
						<li ng-repeat="each in fetchedItems" ng-show="each.isChosen" ng-class="{'selected': each.item_name === selectedChargeItem.item_name}" ng-click="selectUnselect(each)">
							{{ each.item_name }}
							<span count ng-show="each.count > 1">({{ each.count }})</span>
							<span class="base">at {{ currencySymbol }}{{ each.modifiedPrice | number : 2 }} / unit</span>
							<span class="price">
								{{ currencySymbol }}
								<span class="value">{{ each.total_price | number : 2 }}</span>
							</span>
						</li>
						<li ng-repeat="each in fetchedChargeCodes" ng-show="each.isChosen" ng-class="{'selected': each.charge_code === selectedChargeItem.charge_code}" ng-click="selectUnselect(each)">
							{{ each.description }}
							<span count ng-show="each.count > 1">({{ each.count }})</span>
							<span class="base">at {{ currencySymbol }}{{ each.modifiedPrice | number : 2 }} / unit</span>
							<span class="price">
								{{ currencySymbol }}
								<span class="value">{{ each.total_price | number : 2 }}</span>
							</span>
						</li>
					</ul>

				</div>
				<p id="total-charge" class="offset-2">
					Total <span class="price">{{ currencySymbol }} <span class="value">{{ net_total_price | number : 2 }}</span></span>
				</p>
				<div id="numpad" ng-show="selectedChargeItem.item_name || selectedChargeItem.charge_code">
					<div id="numpad-numbers">
						<button value="1" type="button" class="button white" ng-click="calNumAction(1)">
							1
						</button>
						<button value="2" type="button" class="button white" ng-click="calNumAction(2)">
							2
						</button>
						<button value="3" type="button" class="button white" ng-click="calNumAction(3)">
							3
						</button>
						<button value="4" type="button" class="button white" ng-click="calNumAction(4)">
							4
						</button>
						<button value="5" type="button" class="button white" ng-click="calNumAction(5)">
							5
						</button>
						<button value="6" type="button" class="button white" ng-click="calNumAction(6)">
							6
						</button>
						<button value="7" type="button" class="button white" ng-click="calNumAction(7)">
							7
						</button>
						<button value="8" type="button" class="button white" ng-click="calNumAction(8)">
							8
						</button>
						<button value="9" type="button" class="button white" ng-click="calNumAction(9)">
							9
						</button>
						<button value="+/-" type="button" class="button white small" ng-click="calBtnAction('SIGN')">
							+/-
						</button>
						<button value="0" type="button" class="button white" ng-click="calNumAction(0)">
							0
						</button>
						<button value="." type="button" class="button white small" ng-click="calNumAction('.')">
							.
						</button>
					</div>
					<div id="numpad-options">
						<button value="QTY" type="button" id="quantity" class="button white numpad-toggle" ng-class="{selected: calToggle === 'QTY'}" ng-click="calBtnAction('QTY')">
							QTY
						</button>
						<button value="PR" type="button" id="price" class="button white numpad-toggle"  ng-class="{selected: calToggle === 'PR'}" ng-click="calBtnAction('PR')">
							PR
						</button>
						<button value="undo" type="button" class="button white with-icon only-icon clear-value" ng-click="calBtnAction('CLR')">
							<span class="icons icon-clear"></span>Clear last value
						</button>
						<button value="delete" type="button" class="button white with-icon only-icon remove-item" ng-click="removeItem()">
							<span class="icons icon-trash"></span>Remove item
						</button>
					</div>
				</div>
				<div class="actions float">
					<button type="button" id="post" class="button green modal-close" ng-click="postCharges()" translate>POST_CHARGE</button>
					<button type="button" id="cancel" class="button blank modal-close" ng-click="closeDialog()" translate>CANCEL</button>
				</div>
			</div>
		</fieldset>
	    </span>
	    
	    
	    
	    
	    
	    
	    
	</form>
</div>
<div ng-controller = "rvReservationSearchWidgetController" >
	<form method="get" action="" name="dashboard-search-form" id="dashboard-search-form" class="search-form has-dates" role="search" ng-class="{'enable-adding' :showAddNewGuestButton && showSearchResultsArea && textInQueryBox.length !== 0}" outside-click-handler><!--TODO: verify enable-adding -->
	    <div class="entry search">
	    	<button id="dashboard-clear-query" class="clear-query" ng-click="clearResults()" ng-class="{'visible': textInQueryBox!=''}">
	    	    <span class="icons icon-clear-search">Clear query</span>
	    	</button>
	    	<button type="submit" name="submit" class="icons icon-search">Search</button>
	    	<input name="dashboard-query" id="dashboard-query" class="query" placeholder="Name, Group, Room No. or Confirmation No." type="search" autocomplete="off" ng-change="queryEntered()" ng-click="focusOnSearchText()" ng-model="textInQueryBox" focus-me="focusSearchField"/>
	    </div>
	    <div class="entry dates">

            <div class="entry-data has-datepicker">
                <label for="dashboard-date-from">From</label>
                <input name="dashboard-date-from" id="dashboard-date-from" class="hasDatepicker" readonly="" type="text" placeholder="{{fromDate | date : dateFormat }}" value="{{fromDate| date : dateFormat}}"/>
                <button ng-click="showCalendar('RVReservationSearchFromDatepickerCtrl')" type="button" class="ui-datepicker-trigger"></button>
            </div>
            <div class="entry-data has-datepicker">
                <label for="dashboard-date-to">To</label>
                <button id="dashboard-date-to-clear" class="clear-query" ng-class="{'visible': escapeNull(toDate) !=''}">
                    <span class="icons icon-clear-search" ng-click="clearToDateClicked()">Clear query</span>
                </button>

                <input name="dashboard-date-to" id="dashboard-date-to" class="datepicker" placeholder="{{toDate | date : dateFormat}}" value="{{toDate| date : dateFormat}}" readonly="" type="text" />
                <button ng-click="showCalendar('RVReservationSearchToDatepickerCtrl')" type="button" class="ui-datepicker-trigger"></button>
            </div>
        </div>
        <!-- Add reservation -->
    	<a class="add-new-button" ui-sref="rover.reservation.search" ng-show="showAddNewGuestButton && showSearchResultsArea && textInQueryBox.length !== 0">+ New</a>
	</form>
	<div class="search-pagination" ng-show="totalSearchResults >= searchPerPage && results.length > 0">
	    <button type="button" class="button dark-grey next" ng-click="loadNextSet()" ng-disabled="isNextButtonDisabled()">Next</button>
	    <button type="button" class="button dark-grey prev" ng-click="loadPrevSet()" ng-disabled="isPrevButtonDisabled()">Previous</button>
	    <p>Showing <strong>{{start}}-{{end}}</strong> of <strong id="total-count">{{totalSearchResults}}</strong> items</p>
	</div>
	<section ng-attr-id="{{search_area_id}}" class="content scrollable" ng-class="{'no-pagination': ((totalSearchResults < searchPerPage && results.length > 0) || isSwiped), 'no-results' : results.length == 0, 'hidden': !showSearchResultsArea, 'showing-search': searchAreaIsOpening, 'closing-search': searchAreaIsHiding}" role="complementary" ng-show="showSearchResultsArea" ng-iscroll="result_showing_area" ng-iscroll-delay="1000">
	    <div class="wrapper">
	    	<div ng-include="'/assets/partials/common/notification_message.html'"></div>
	        <ul id="dashboard-search-results" class="search-results" > <!-- since parent id & class must have roles in displaying the bottom results, we are seperating these -->
				<li class="reservation" ng-repeat="row in results" ng-show="row.is_row_visible" ngrepeatend ngrepeatstarted>
					<a ng-class="getReservationClass(row.reservation_status)" ng-click="goToReservationDetails($event,row.id, row.confirmation)"> <!-- add class "accompany" if it's a accompanying guest -->
                    <figure class="guest-image" ng-class="{'accompany': row.images.length >1}" ng-show="row.images.length!=0 "><!-- add class "accompany" if it's a accompanying guest -->
                       <img ng-repeat="image in row.images" ng-src="{{image.guest_image}}" ng-class="{'first-image':(row.images.length >1 && image.is_primary==true)}">
                        <!-- if it's accompanying guest, show this as well:
                        <img src="{accompanying-guest-image-or-avatar}" alt="" />-->
                    </figure>
                    <div clas="data" ng-class="{'no-guest-info': escapeNull(row.company)=='' && escapeNull(row.travel_agent)=='' && escapeNull(row.group)=='' && escapeNull(row.allotment)==''}"> <!-- Add class "no-guest-info" if there's no company, ta and group attached -->
                        <!-- If there is a 'guest-name' :
                                - {lastname}, {firstname}
                             Where there is no guest-name: 'Pending'
                        -->
                        <!-- Where the guest-name is 'Pending', add class .pending -->
                        <!-- Add .cancelled if the guest has cancelled or no show -->
                        <h2 ng-show="escapeNull(row.lastname) != '' || escapeNull(row.firstname) != ''">{{escapeNull(row.lastname)|highlight:textInQueryBox:false}} {{escapeNull(row.firstname)|highlight:textInQueryBox:false}}</h2>
                        <h2 class="pending" ng-if="escapeNull(row.lastname) == '' && escapeNull(row.firstname) ==">Pending</h2>
                        <span class="confirmation">
                            <!-- In design the 'confirmation-text' can be:
                                 'CONF.' or 'EXT.'
                            -->
                            <span class="confirmation-text">CONF.</span>
                            {{escapeNullStr(row.confirmation)}}
                            <span class="confirmation-text">EXT.</span>
                            {{escapeNullStr(row.external_confirm_no)}}
                        </span>
                        <span class="icons icon-location" ng-hide="escapeNullStr(row.location)==''">{{escapeNullStr(row.location)}}</span> <!-- If no data don't output this line -->


                        <span class="guest-status check-in"></span>
                        <time class="guest-time">
                            <span>{{row.arrival_date| date : dateFormat}}</span>
                            <span class="hours">{{getTimeConverted(row.arrival_time)}}</span>
                        </time>

                        <span class="guest-status check-out"></span>
                        <time class="guest-time">
                            <span>{{row.departure_date| date : dateFormat}}</span>
                            <span class="hours">{{getTimeConverted(row.departure_time)}}</span>
                        </time>
                    </div>
                    <div class="guest-info" ng-hide="escapeNull(row.company)=='' && escapeNull(row.travel_agent)=='' && escapeNull(row.group)=='' && escapeNull(row.allotment)==''">
	                        <span class="icons icon-guest-company" ng-if="escapeNull(row.company)!=''" ng-bind-html="escapeNull(row.company)|highlight:textInQueryBox:false"></span>
	                        <span class="icons icon-guest-travelagent" ng-if="escapeNull(row.travel_agent)!=''" ng-bind-html="escapeNull(row.travel_agent)|highlight:textInQueryBox:false"></span>
	                        <span class="icons icon-group" ng-if="escapeNull(row.group)!=''" ng-bind-html="escapeNull(row.group)|highlight:textInQueryBox:false"></span>
	                        <span class="icons icon-allotment" ng-if="escapeNull(row.allotment)!=''" ng-bind-html="escapeNull(row.allotment)|highlight:textInQueryBox:false"></span>
	                    </div>

                    <!-- 1. if room is assigned, show this -->
                    <div class="reservation-info" ng-if="escapeNull(row.room) != ''">
                        <!-- Display .guest-info all the time, even with no data -->
                        <div class="guest-info">
                            <span class="icons icon-guest-company" ng-if="escapeNull(row.company)!=''" ng-bind-html="escapeNull(row.company)|highlight:textInQueryBox:false"></span>
	                        <span class="icons icon-guest-travelagent" ng-if="escapeNull(row.travel_agent)!=''" ng-bind-html="escapeNull(row.travel_agent)|highlight:textInQueryBox:false"></span>
	                        <span class="icons icon-group" ng-if="escapeNull(row.group)!=''" ng-bind-html="escapeNull(row.group)|highlight:textInQueryBox:false"></span>
	                        <span class="icons icon-allotment" ng-if="escapeNull(row.allotment)!=''" ng-bind-html="escapeNull(row.allotment)|highlight:textInQueryBox:false"></span>
                        </div>

                        <!-- this can be either arrival or departure date, depending on reservation status -->
                        <div class="reservation-status">
                            <span class="guest-status {{getGuestStatusMapped(row.reservation_status, row.is_opted_late_checkout,row.is_pre_checkin , row.arrival_date)}}">{{getGuestStatusMapped(row.reservation_status, row.is_opted_late_checkout,row.is_pre_checkin, row.arrival_date)}}</span>
                        </div>

                        <div class="room-info">
                            <!-- Arrivals, check ins and pre check ins - room ready -->
                            <strong class="room-number {{getRoomStatusMapped(row.roomstatus, row.fostatus, row.room) }}">{{getRoomNo()}}</strong>
                            <span class="room-type">{{row.room_type}}</span>

                            <!-- If room is queued -->
                            <span class="icons icon-queued" ng-if="isReservationQueued(row.is_reservation_queued, row.is_queue_rooms_on, row.reservation_status)">Queued</span>

                        </div>
                        <!-- Arrivals, check ins and pre check ins - room not ready -->
                         <span class="room-status">{{row.roomstatus}}</span>
                    </div>

                </a>
				</li>
				<li class="no-content" ng-show="showNoMatches(results, textInQueryBox.trim().length, isTyping, isSwiped)" >
					<div class="info">
						<span class="icon-no-content icon-search"></span>
						<strong class="h1">No matches </strong>
						<span class="h2">Check that you didn't mispell the <strong>Name</strong> or
							<strong>Group</strong>, or typed in the wrong <strong>Room </strong> or
							<strong>Confirmation</strong> number
							<span ng-show="results.length==0 && showAddNewGuestButton">, or
							<a ui-sref="rover.reservation.search">Add a New Guest <a/></span>
						</span>
						.
					</div>
				</li>
				<li class="no-content" ng-show="results.length == 0 && searchType != 'default' && (isLateCheckoutList && textInQueryBox=='')">
					<div class="info">
						<span class="icon-no-content icon-search"></span>
						<strong class="h1">No guests opted for late checkout </strong>
					</div>
				</li>
				<li class="no-content" ng-show="results.length == 0 && textInQueryBox.trim().length<=3 && !swipeNoResults">
					<div class="info">
						<span class="icon-no-content icon-search"></span>
						<strong class="h1">Find Guests</strong>
						<span class="h2">
							Search by
							<strong>Name</strong>,
							<strong>Group</strong>,
							<strong>Room No.</strong>
							or
							<strong>Confirmation No.</strong>
						</span>
					</div>
				</li>
				<li class="no-content" ng-show="swipeNoResults">
					<div class="info">
						<span class="icon-no-content icon-search" ></span>
						<strong class="h1">No matches </strong>
						<span class="h2">Enter different search criteria to find reservation / guest.

						</span>

					</div>
				</li>
	        </ul>
	    </div>
	</section>
</div>